import{_ as T,a as Z}from"./EmployeesListModal.vue_vue_type_script_setup_true_lang.89129a5c.js";import{_ as q}from"./SubmitButton.vue_vue_type_script_setup_true_lang.fe21b651.js";import{_ as A}from"./PageHeader.vue_vue_type_script_setup_true_lang.546c13dd.js";import{d as J,n as Q,u as W,a as X,bO as Y,B as r,c as ee,Z as x,y as se,w as B,i as $,o as b,e as w,j as d,k as E,f as s,t as l,v as te,z as k,l as ae,g as M,bS as F}from"./index.3390162f.js";import{C as oe,a as ne,e as le}from"./editor-config.1c50d29d.js";import{k as ie,u as de,l as ue}from"./index.88fda4e6.js";import"./Pagination.f4a9fc5d.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./vue.runtime.esm-bundler.84001772.js";const ce={class:"createMessageList"},re={class:"btns c-save px-4",type:"button"},pe=s("i",{class:"mdi mdi-comment-multiple me-2"},null,-1),me={class:"row"},_e={class:"col-12"},fe={class:"card"},ve={class:"card-header bg-card-header justify-content-between d-flex align-items-center"},he={class:"card-title"},ge={class:"card-body"},ye={class:"row"},be={class:"col-md-8"},we={class:"text-danger"},ke={class:"col-md-2"},Ce=s("i",{class:"mdi mdi-plus me-2"},null,-1),$e={class:"col-md-2"},Ee=s("i",{class:"mdi mdi-plus me-2"},null,-1),Me={class:"row my-3"},Se={class:"col col-md-6"},Ue={class:"text-danger"},De={class:"col-auto ms-auto align-self-center"},Le={key:0},Oe=["href"],xe=s("span",{class:"mdi mdi-paperclip"},null,-1),Be={class:"col-auto"},Fe={class:"input-group"},Ie={class:"input-group-text",for:"inputGroupFile01",style:{"border-radius":"0.75rem 0 0 0.75rem"}},Ve={class:"text-danger"},je={class:"text-danger"},Ne={class:"mt-3 d-flex"},Re=["disabled"],Ge={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Ke={key:1,class:"mdi mdi-content-save me-1"},Xe=J({__name:"[id]",setup(ze){var L,O;const I=Q(),V=W(),{t:S}=X(),f=(O=(L=I.params)==null?void 0:L.id)!=null?O:null,U=Y(),j=oe.component,u=r(!1),v=r(!1),h=r(!1),p=r([]),m=r([]),N=ee(()=>[...p.value.map(t=>t.full_name),...m.value.map(t=>t.full_name)]),o=x({users:[],theme:"",message:"",file_path:""}),c=x({users:[],theme:[],message:[],file:[]}),C=r(),_=r(null);se(async()=>{var t,e;if(f){const i=await ie(f);o.theme=i.theme,o.message=(t=i.message)!=null?t:"",o.file_path=(e=i.file_path)!=null?e:"",i.receivers.forEach(a=>{a.employee?p.value.push({id:a.employee.user_id,full_name:a.employee.full_name}):a.student&&m.value.push({id:a.student.user_id,full_name:a.student.full_name})})}C.value&&(C.value.onchange=i=>{var y;const a=i.target,g=document.getElementById("inputGroupFile01");g&&(g.value=(y=a.value)==null?void 0:y.replace(/C:\\fakepath\\/i,"")),_.value=a.files[0]})}),B(v,function(t){const e=F.getOrCreateInstance("#employeesListModal");t?e.show():e.hide()}),B(h,function(t){const e=F.getOrCreateInstance("#studentsListModal");t?e.show():e.hide()});async function R(){var t;try{u.value=!0,D();const e=new FormData;e.append("theme",o.theme),e.append("message",o.message),[...p.value.map(a=>a.id),...m.value.map(a=>a.id)].forEach(a=>{e.append("users[]",a)}),_.value&&e.append("file",_.value),await ue(f,e),U.success(S("Message_sent")),V.back()}catch(e){Object.assign(c,(t=e.response)==null?void 0:t.data)}finally{u.value=!1}}async function G(){var t;try{u.value=!0,D();const e=new FormData;e.append("theme",o.theme),e.append("message",o.message),[...p.value.map(a=>a.id),...m.value.map(a=>a.id)].forEach(a=>{e.append("users[]",a)}),_.value&&e.append("file",_.value),await de(f,e),U.success(S("Message_saved"))}catch(e){Object.assign(c,(t=e.response)==null?void 0:t.data)}finally{u.value=!1}}function D(){Object.assign(c,{users:[],theme:[],message:[],file:[]})}function K(){const t=document.getElementById("file_upload");t==null||t.click()}return(t,e)=>{const i=$("RouterLink"),a=A,g=$("a-textarea"),y=$("a-input"),z=q,H=T,P=Z;return b(),w("div",ce,[d(a,{title:t.$t("Compose_message")},{default:E(()=>[d(i,{to:"/messages/all"},{default:E(()=>[s("button",re,[pe,s("span",null,l(t.$t("My_messages")),1)])]),_:1})]),_:1},8,["title"]),s("div",me,[s("div",_e,[s("div",fe,[s("div",ve,[s("h4",he,l(t.$t("Create_new_message")),1)]),s("div",ge,[s("form",{onSubmit:te(R,["prevent"])},[s("div",ye,[s("div",be,[d(g,{value:N.value,rows:1,placeholder:t.$t("Recipients")},null,8,["value","placeholder"]),s("span",we,l(c.users[0]),1)]),s("div",ke,[s("button",{class:"btns student-c py-2 px-4 w-100",type:"button",onClick:e[0]||(e[0]=n=>v.value=!0)},[Ce,k(" "+l(t.$t("Employee")),1)])]),s("div",$e,[s("button",{type:"button",class:"btns c-save py-2 px-4 w-100",onClick:e[1]||(e[1]=n=>h.value=!0)},[Ee,k(" "+l(t.$t("Student")),1)])])]),s("div",Me,[s("div",Se,[d(y,{value:o.theme,"onUpdate:value":e[2]||(e[2]=n=>o.theme=n),type:"text",placeholder:t.$t("Subject")},null,8,["value","placeholder"]),s("span",Ue,l(c.theme[0]),1)]),s("div",De,[o.file_path?(b(),w("div",Le,[s("a",{href:o.file_path,download:""},[xe,k(" "+l(t.$t("attached_file")),1)],8,Oe)])):ae("",!0)]),s("div",Be,[s("div",Fe,[s("input",{type:"file",id:"file_upload",ref_key:"fileUpload",ref:C,class:"d-none"},null,512),s("label",Ie,l(t.$t("attach_file")),1),s("input",{type:"text",class:"form-control",id:"inputGroupFile01",onClick:K})]),s("span",Ve,l(c.file[0]),1)])]),d(M(j),{modelValue:o.message,"onUpdate:modelValue":e[3]||(e[3]=n=>o.message=n),editor:M(ne),config:M(le)},null,8,["modelValue","editor","config"]),s("span",je,l(c.message[0]),1),s("div",Ne,[s("button",{class:"btns black-c py-2 my-1",type:"button",onClick:G,disabled:u.value},[u.value?(b(),w("span",Ge)):(b(),w("i",Ke)),s("span",null,l(t.$t("Save_to_draft")),1)],8,Re),d(z,{class:"c-filter py-2 px-4 my-1 ms-auto",loading:u.value},{default:E(()=>[k(l(t.$t("Send_message")),1)]),_:1},8,["loading"])])],32),d(H,{"is-open":v.value,"onUpdate:isOpen":e[4]||(e[4]=n=>v.value=n),"selected-employees":p.value,"onUpdate:selectedEmployees":e[5]||(e[5]=n=>p.value=n)},null,8,["is-open","selected-employees"]),d(P,{"is-open":h.value,"onUpdate:isOpen":e[6]||(e[6]=n=>h.value=n),"selected-students":m.value,"onUpdate:selectedStudents":e[7]||(e[7]=n=>m.value=n)},null,8,["is-open","selected-students"])])])])])])}}});export{Xe as default};
