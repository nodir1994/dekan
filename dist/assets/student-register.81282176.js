import{_ as ss}from"./Pagination.f4a9fc5d.js";import{_ as ts}from"./LoadingOverlay.vue_vue_type_script_setup_true_lang.89ce9ad6.js";/* empty css                                                       */import{bR as es,d as as,a as ds,bO as ls,B as T,Z as v,c as B,y as is,w,i as z,o as _,e as h,f as t,t as c,s as P,l as y,j as f,g as N,bs as O,bH as $,F as x,r as E,z as M,aR as H,k as Z}from"./index.3390162f.js";import{j as os}from"./index.30e99442.js";import{a as us,b as cs,s as ns}from"./id.5a6e5f30.js";/* empty css                                                               */import{h as q}from"./helper.569bc08f.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./vue.runtime.esm-bundler.84001772.js";import"./sweetalert2.all.fdef424e.js";import"./moment.2cad4b18.js";const S=es();async function rs(r){try{const{data:o}=await S({url:`api/student-subjects/filter/students?academic_group_id=${r.academic_group_id}&semester_id=${r.semester_id}`,params:r});return o}catch(o){throw o}}async function _s(r){try{const{data:o}=await S({url:"api/student-subjects",params:r});return o}catch(o){throw o}}async function ps(r){try{const{data:o}=await S({url:"api/students",params:r});return o}catch(o){throw o}}async function hs(r){try{const{data:o}=await S({url:"api/student-subjects/delete",method:"DELETE",data:r});return o}catch(o){throw o}}async function ms(r){try{const{data:o}=await S({url:`api/student-subjects/subjects?edu_plan_id=${r.edu_plan_id}&semester_id=${r.semester_id}`});return o}catch(o){throw o}}async function bs(r){try{const{data:o}=await S({url:"/api/student-subjects",method:"POST",data:r});return o}catch(o){throw o}}const gs={pagetitle:"'Fanga biriktirish'",class:"transferPage"},vs={class:"card panel-header-bg"},fs={class:"card-body"},ys={class:"panel-header p-2 ps-0"},js={class:"card-title"},ks={class:"row"},ws={class:"col-lg-6"},Os={class:"card"},$s={class:"card-body"},Ss={class:"mb-3"},Cs={class:"row"},Us={class:"col-xl-6"},Ps={class:"mb-3",name:"nameFaculty"},Fs={class:"col-xl-6"},Ns={class:"mb-3",name:"nameFaculty"},Ls={class:"col-xl-6"},Gs={class:"mb-3",name:"nameFaculty"},Bs={class:"col-xl-6"},xs={class:"mb-3",name:"nameFaculty"},Es={key:0,class:"text-danger small"},Ys={class:"table-responsive"},Vs={class:"content-table"},As={class:"table-row-all-coupling"},Rs={class:"form-check"},Is=t("th",null,"#",-1),Ws={class:"form-check"},Ts=["value"],zs=t("br",null,null,-1),Ms={class:"col-lg-6"},Hs={class:"card"},Zs={class:"card-body"},qs={class:"mb-3"},Js={class:"table-responsive"},Ks={class:"content-table"},Qs={class:"table-row-all-coupling2"},Xs={class:"form-check"},Ds=t("th",null,"#",-1),st={class:"form-check"},tt=["value"],et={class:"d-flex justify-content-end"},at=["disabled"],dt=t("i",{class:"mdi mdi-check font-size-14 align-middle me-1"},null,-1),lt={class:"col-12 mt-4"},it={key:0,class:"card"},ot={class:"card-body"},ut={class:"card"},ct={class:"row"},nt={class:"my-2 col-xl-6 form--item"},rt={for:"yu"},_t={class:"my-2 col-xl-6 form--item"},pt={for:"yu"},ht={class:"table-responsive"},mt={class:"content-table"},bt={class:"table-row-all-coupling3"},gt=t("th",null,"#",-1),vt={class:"form-check"},ft=["value"],yt={class:"d-flex justify-content-end"},jt=["disabled"],Bt=as({__name:"student-register",setup(r){const{t:o}=ds(),F=ls(),m=T(!1);v({});const L=T(!1),i=v({students:[],subject_id:null,student_id:null}),s=v({edu_plan_id:null,academic_year_id:null,semester_id:null,academic_group_id:null,curriculum_id:null,data_subjects:[],data:[],subjects:[],links:[],students:[],total:0}),n=v({eduPlanOptions:null,academicYearsOptions:null,semesterOptions:null,academicGroupOptions:null,subjectsOptions:null,studentOptions:null}),p=v({students:[],subjects:[],enroll:[]}),Y=B({get(){var d,a,l,u;return((d=s==null?void 0:s.students)==null?void 0:d.length)===((l=(a=p.students)==null?void 0:a.value)==null?void 0:l.length)&&((u=s==null?void 0:s.students)==null?void 0:u.length)>0},set(d){d?s.students=p.students.value:s.students=[]}}),V=B({get(){var d,a,l,u;return((d=s==null?void 0:s.data_subjects)==null?void 0:d.length)===((l=(a=p.subjects)==null?void 0:a.value)==null?void 0:l.length)&&((u=s==null?void 0:s.subjects)==null?void 0:u.length)>0},set(d){d?s.subjects=p.subjects.value:s.subjects=[]}}),A=B({get(){var d,a,l,u;return((d=i==null?void 0:i.students)==null?void 0:d.length)===((l=(a=p.enroll)==null?void 0:a.value)==null?void 0:l.length)&&((u=i==null?void 0:i.students)==null?void 0:u.length)>0},set(d){d?i.students=p.enroll.value:i.students=[]}});is(async()=>{n.eduPlanOptions=await os().then(d=>{var a;return(a=d==null?void 0:d.result)==null?void 0:a.data})}),w(()=>s.edu_plan_id,async()=>{var d,a;if(s.academic_year_id=null,s.semester_id=null,s.academic_group_id=null,n.academicYearsOptions=null,n.academicGroupOptions=null,n.semesterOptions=null,s.edu_plan_id){let l=await us(s.edu_plan_id);n.academicYearsOptions=(d=l==null?void 0:l.result)==null?void 0:d.data.map(b=>({id:b.id,name:b.name}));let u=await cs(s.edu_plan_id);n.academicGroupOptions=(a=u==null?void 0:u.result)==null?void 0:a.data.map(b=>({id:b.id,name:b.name}))}else s.data=[],s.subjects=[]}),w(()=>s.academic_year_id,async()=>{var d;if(s.semester_id=null,n.semesterOptions=null,s.edu_plan_id&&s.academic_year_id){let a=await ns(s);n.semesterOptions=(d=a==null?void 0:a.result)==null?void 0:d.data.map(l=>({id:l.id,semester:l.semester,name:l.course+"-"+o("Course")+" "+l.semester+"-"+o("semester")}))}await U()}),w(()=>[i.subject_id,i.student_id],async()=>{await G()}),w(()=>[s.academic_group_id,s.semester_id],async()=>{await U(),s.academic_group_id&&await G();const d={academic_group_id:s.academic_group_id,semester_id:s.semester_id};d.academic_group_id&&d.semester_id&&(n.studentOptions=await rs(d))}),w(()=>s.current_page,async d=>{Number(d)&&(s.page=Number(d),await U(d))}),w(()=>i.current_page,async d=>{Number(d)&&(i.page=Number(d),await G(d))});function J(){Object.assign(C,{academic_group_id:[]})}const C=v({edu_plan_id:[],semester_id:[]});async function U(d){if(s.semester_id&&s.academic_group_id)try{let a=v({page:d||1,per_page:q.pagePer});s.edu_plan_id&&(a.edu_plan_id=s.edu_plan_id),s.academic_year_id&&(a.academic_year_id=s.academic_year_id),s.semester_id&&(a.semester_id=s.semester_id),s.academic_group_id&&(a.academic_group_id=s.academic_group_id),m.value=!0;const l=await ps(a);Object.assign(s,l.result),s.data_subjects=await ms(a).then(u=>u==null?void 0:u.result),n.subjectsOptions=s.data_subjects.map(u=>({id:u.subject.id,name:u.subject.name})),p.subjects.value=s.data_subjects.map(u=>u.id),p.students.value=s.data.map(u=>u.id)}catch(a){console.log(a)}finally{m.value=!1}else s.data=[],s.data_subjects=[]}async function G(d){if(s.semester_id&&s.academic_group_id){let a=v({page:d||1,per_page:q.pagePer});s.edu_plan_id&&(a.edu_plan_id=s.edu_plan_id),s.semester_id&&(a.semester_id=s.semester_id),s.academic_group_id&&(a.academic_group_id=s.academic_group_id),i.subject_id&&(a.subject_id=i.subject_id),i.student_id&&(a.student_id=i.student_id),L.value=!0;try{const l=await _s(a);Object.assign(i,l.result),p.enroll.value=i.data.map(u=>u.id)}catch(l){console.log(l)}finally{L.value=!1}}else i.data=[]}async function K(){var d,a;try{m.value=!0,J();let l={};s.page>1&&(l.page=s==null?void 0:s.page),Object.assign(l,{students:s.students,curriculum_subjects:s.subjects,semester_id:s.semester_id2,academic_group_id:s.academic_group_id});const u=await bs(l);F.success(o("Selected_students_for_subject_is_successfully_registered")),s.subjects=[],s.students=[],U()}catch(l){Object.assign(C,(a=(d=l.response)==null?void 0:d.data)==null?void 0:a.errors),F.error(o("Failed")+": "+l.message)}finally{m.value=!1}}async function Q(){var d,a;try{m.value=!0;let l={student_subjects:i.students};await hs(l),F.success(o("Delete_message.Record_deleted_successfull")),U()}catch(l){Object.assign(C,(a=(d=l.response)==null?void 0:d.data)==null?void 0:a.errors),F.error(o("Failed")+": "+l.message)}finally{m.value=!1}}const X=(d,a)=>a.name.toLowerCase().indexOf(d.toLowerCase())>=0;return(d,a)=>{var I,W;const l=ts,u=z("a-select"),b=ss,R=z("a-space");return _(),h("div",gs,[t("div",vs,[t("div",fs,[t("div",ys,[t("h5",js,c(d.$t("attach__subject")),1)])])]),t("div",ks,[t("div",ws,[t("div",Os,[t("div",$s,[m.value?(_(),P(l,{key:0})):y("",!0),t("h4",Ss,c(d.$t("Students_in_Group")),1),t("form",Cs,[t("div",Us,[t("div",Ps,[f(u,{"allow-clear":"",value:s.edu_plan_id,"onUpdate:value":a[0]||(a[0]=e=>s.edu_plan_id=e),"field-names":{value:"id",label:"name"},options:n.eduPlanOptions,placeholder:d.$t("Please_select_curriculum")},null,8,["value","options","placeholder"])])]),t("div",Fs,[t("div",Ns,[f(u,{"allow-clear":"",value:s.academic_year_id,"onUpdate:value":a[1]||(a[1]=e=>s.academic_year_id=e),"field-names":{value:"id",label:"name"},options:n.academicYearsOptions,disabled:!s.edu_plan_id,placeholder:N(o)("Choose_Education_Year")},null,8,["value","options","disabled","placeholder"])])]),t("div",Ls,[t("div",Gs,[f(u,{"allow-clear":"",value:s.semester_id,"onUpdate:value":a[2]||(a[2]=e=>s.semester_id=e),"field-names":{value:"id",label:"name"},options:n.semesterOptions,disabled:!s.academic_year_id,placeholder:N(o)("Choose_Semester")},null,8,["value","options","disabled","placeholder"])])]),t("div",Bs,[t("div",xs,[f(u,{"allow-clear":"",value:s.academic_group_id,"onUpdate:value":a[3]||(a[3]=e=>s.academic_group_id=e),"field-names":{value:"id",label:"name"},options:n.academicGroupOptions,disabled:!s.semester_id,placeholder:N(o)("Choose_Group")},null,8,["value","options","disabled","placeholder"]),C.academic_group_id?(_(),h("span",Es,c(C.academic_group_id[0]),1)):y("",!0)])])]),t("div",Ys,[t("table",Vs,[t("thead",null,[t("tr",As,[t("th",null,[t("div",Rs,[O(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a[4]||(a[4]=e=>Y.value=e)},null,512),[[$,Y.value]])])]),Is,t("th",null,c(d.$t("Student")),1),t("th",null,c(d.$t("by_Specialty")),1)])]),t("tbody",null,[(_(!0),h(x,null,E(s.data,(e,j)=>{var g;return _(),h("tr",{class:"table-row-all-coupling",key:e==null?void 0:e.id},[t("td",null,[t("div",Ws,[O(t("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":a[5]||(a[5]=k=>s.students=k),value:e==null?void 0:e.id},null,8,Ts),[[$,s.students]])])]),t("td",null,c(e==null?void 0:e.id),1),t("td",null,[M(c(e==null?void 0:e.fullname)+" ",1),zs]),t("td",null,c((g=e==null?void 0:e.specialty)==null?void 0:g.name),1)])}),128))])]),s.last_page>1&&s.edu_plan_id?(_(),P(b,H({key:0,class:"mt-2"},{...s},{"current-page":s.current_page,"onUpdate:currentPage":a[6]||(a[6]=e=>s.current_page=e)}),null,16,["current-page"])):y("",!0)])])])]),t("div",Ms,[t("div",Hs,[t("div",Zs,[m.value?(_(),P(l,{key:0})):y("",!0),t("h4",qs,c(d.$t("Subjects_in_Curriculum")),1),t("div",Js,[t("table",Ks,[t("thead",null,[t("tr",Qs,[t("th",null,[t("div",Xs,[O(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a[7]||(a[7]=e=>V.value=e)},null,512),[[$,V.value]])])]),Ds,t("th",null,c(d.$t("Subjects")),1),t("th",null,c(d.$t("sciense_type")),1)])]),t("tbody",null,[(_(!0),h(x,null,E(s.data_subjects,(e,j)=>{var g;return _(),h("tr",{class:"table-row-all-coupling2",key:e==null?void 0:e.id},[t("td",null,[t("div",st,[O(t("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":a[8]||(a[8]=k=>s.subjects=k),value:e==null?void 0:e.id},null,8,tt),[[$,s.subjects]])])]),t("td",null,c(j+1)+"/1",1),t("td",null,c((g=e==null?void 0:e.subject)==null?void 0:g.name),1),t("td",null,c(e==null?void 0:e.type),1)])}),128))])])]),t("div",et,[t("button",{class:"btns c-save mt-3 py-1.5 px-4",onClick:K,disabled:!(((I=s.subjects)==null?void 0:I.length)>0&&((W=s.students)==null?void 0:W.length)>0),type:"button"},[dt,M("Ok ")],8,at)])])])]),t("div",lt,[(i==null?void 0:i.data)&&s.edu_plan_id?(_(),h("div",it,[t("div",ot,[L.value?(_(),P(l,{key:0})):y("",!0),t("h3",null,c(d.$t("student__register__by__subjects")),1),t("div",ut,[t("div",ct,[t("div",nt,[f(R,null,{default:Z(()=>[f(u,{"allow-clear":"",value:i.subject_id,"onUpdate:value":a[9]||(a[9]=e=>i.subject_id=e),"field-names":{value:"id",label:"name"},options:n.subjectsOptions},null,8,["value","options"])]),_:1}),t("label",rt,c(d.$t("Choose_Subject")),1)]),t("div",_t,[f(R,null,{default:Z(()=>{var e;return[f(u,{"allow-clear":"",value:i.student_id,"onUpdate:value":a[10]||(a[10]=j=>i.student_id=j),"field-names":{value:"id",label:"fullname"},options:(e=n.studentOptions)==null?void 0:e.result,"filter-option":X,"show-search":""},null,8,["value","options"])]}),_:1}),t("label",pt,c(d.$t("Choose_Student")),1)])])]),t("div",ht,[t("table",mt,[t("thead",null,[t("tr",bt,[t("th",null,[O(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a[11]||(a[11]=e=>A.value=e)},null,512),[[$,A.value]])]),gt,t("th",null,c(d.$t("Student")),1),t("th",null,c(d.$t("Subjects")),1),t("th",null,c(d.$t("Education_Year_Name")),1),t("th",null,c(d.$t("Semester_Name")),1),t("th",null,c(d.$t("Group")),1)])]),t("tbody",null,[(_(!0),h(x,null,E(i.data,(e,j)=>{var g,k;return _(),h("tr",{class:"table-row-all-coupling3",key:e==null?void 0:e.id},[t("td",null,[t("div",vt,[O(t("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":a[12]||(a[12]=D=>i.students=D),value:e==null?void 0:e.id},null,8,ft),[[$,i.students]])])]),t("td",null,c((i.current_page-1)*i.per_page+j+1),1),t("td",null,c((g=e==null?void 0:e.student)==null?void 0:g.fullname),1),t("td",null,c((k=e==null?void 0:e.subject)==null?void 0:k.name),1),t("td",null,c(e==null?void 0:e.academic_year),1),t("td",null,c(e==null?void 0:e.semester)+"-"+c(N(o)("semestr")),1),t("td",null,c(e==null?void 0:e.academic_group),1)])}),128))])]),i.last_page>1&&s.edu_plan_id?(_(),P(b,H({key:0,class:"mt-2"},{...i},{"current-page":i.current_page,"onUpdate:currentPage":a[13]||(a[13]=e=>i.current_page=e)}),null,16,["current-page"])):y("",!0),t("div",yt,[t("button",{type:"button",disabled:!i.students.length,onClick:Q,class:"btns c-delete mt-3"},c(d.$t("Remove")),9,jt)])])])])):y("",!0)])])])}}});export{Bt as default};
