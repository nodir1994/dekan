import{_ as z,a as A}from"./EmployeesListModal.vue_vue_type_script_setup_true_lang.89129a5c.js";import{_ as H}from"./SubmitButton.vue_vue_type_script_setup_true_lang.fe21b651.js";import{_ as P}from"./PageHeader.vue_vue_type_script_setup_true_lang.546c13dd.js";import{d as Z,a as J,n as Q,u as W,bO as X,B as u,Z as F,c as Y,y as ee,w as k,i as w,o as y,e as b,j as c,k as M,f as t,t as l,v as se,g as f,F as te,z as $,l as ae,bS as L,p as oe,m as ne}from"./index.3390162f.js";import{C as le,a as ie,e as de}from"./editor-config.1c50d29d.js";import{s as ce,e as re}from"./index.88fda4e6.js";import{_ as pe}from"./_plugin-vue_export-helper.cdc0426e.js";import"./Pagination.f4a9fc5d.js";import"./vue.runtime.esm-bundler.84001772.js";const E=v=>(oe("data-v-92c4c090"),v=v(),ne(),v),ue={class:"createMessageList"},me={class:"btns c-save px-4",type:"button"},_e=E(()=>t("i",{class:"mdi mdi-comment-multiple me-2"},null,-1)),fe={class:"row"},ve={class:"col-12"},ge={class:"card"},he={class:"card-header bg-card-header justify-content-between d-flex align-items-center"},ye={class:"card-title"},be={class:"card-body"},Ce={class:"row"},Se={class:"col-md-8"},ke={class:"text-danger"},we={class:"col-md-2"},Me=E(()=>t("i",{class:"mdi mdi-plus me-2"},null,-1)),$e={class:"col-md-2"},Ee=E(()=>t("i",{class:"mdi mdi-plus me-2"},null,-1)),Ie={class:"row my-3"},Ue={class:"col col-md-6"},xe={class:"text-danger"},Fe={class:"col-auto ms-auto"},Le={class:"input-group"},Oe={class:"input-group-text",for:"inputGroupFile01",style:{"border-radius":"0.75rem 0 0 0.75rem"}},je={class:"text-danger"},Be={class:"text-danger"},De={class:"mt-3 d-flex"},Ne=["disabled"],Ge={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Re={key:1,class:"mdi mdi-content-save me-1"},Ve=Z({__name:"compose",setup(v){const{locale:qe,t:I}=J(),C=Q(),O=W(),U=X(),j=le.component,r=u(!1),g=u(!1),h=u(!1),i=u([]),m=u([]),a=F({users:[],theme:"",message:"",department_id:null,academic_group_id:null}),p=F({users:[],theme:[],message:[],file:[]}),B=Y(()=>{let s="";return i.value.length>0&&(s+=i.value.map(e=>e.full_name).join(", ")),m.value.length>0&&(i.value.length>0&&(s+=", "),s+=m.value.map(e=>e.full_name).join(", ")),s}),S=u(),_=u(null);ee(()=>{S.value&&(S.value.onchange=s=>{var n;const e=s.target,d=document.getElementById("inputGroupFile01");d&&(d.value=(n=e.value)==null?void 0:n.replace(/C:\\fakepath\\/i,"")),_.value=e.files[0]})}),k(()=>C.query,s=>{s.id&&s.name&&i.value.push({id:Number(s.id),full_name:String(s.name)})},{immediate:!0}),k(g,function(s){const e=L.getOrCreateInstance("#employeesListModal");s?e.show():e.hide()}),k(h,function(s){const e=L.getOrCreateInstance("#studentsListModal");s?e.show():e.hide()});async function D(){var s;try{r.value=!0,x();const e=new FormData;e.append("theme",a.theme),e.append("message",a.message),a.department_id&&e.append("department_id",a.department_id),a.academic_group_id&&e.append("academic_group_id",a.academic_group_id);const d=[...i.value.map(n=>n.id),...m.value.map(n=>n.id)];d.length>0?d.forEach(n=>{e.append("users[]",n)}):e.append("users",""),_.value&&e.append("file",_.value),await re(e),U.success(I("Message_sent")),O.push({path:"/messages/all"})}catch(e){Object.assign(p,(s=e.response)==null?void 0:s.data)}finally{r.value=!1}}async function N(){var s;try{r.value=!0,x();const e=new FormData;e.append("theme",a.theme),e.append("message",a.message),a.department_id&&e.append("department_id",a.department_id),a.academic_group_id&&e.append("academic_group_id",a.academic_group_id),[...i.value.map(n=>n.id),...m.value.map(n=>n.id)].forEach(n=>{e.append("users[]",n)}),_.value&&e.append("file",_.value),await ce(e),U.success(I("Message_saved"))}catch(e){Object.assign(p,(s=e.response)==null?void 0:s.data)}finally{r.value=!1}}function x(){Object.assign(p,{users:[],theme:[],message:[],file:[]})}function G(){const s=document.getElementById("file_upload");s==null||s.click()}return(s,e)=>{const d=w("RouterLink"),n=P,R=w("a-textarea"),V=w("a-input"),q=H,K=z,T=A;return y(),b("div",ue,[c(n,{title:s.$t("Compose_message")},{default:M(()=>[c(d,{to:"/messages/all"},{default:M(()=>[t("button",me,[_e,t("span",null,l(s.$t("My_messages")),1)])]),_:1})]),_:1},8,["title"]),t("div",fe,[t("div",ve,[t("div",ge,[t("div",he,[t("h4",ye,l(s.$t("Create_new_message")),1)]),t("div",be,[t("form",{onSubmit:se(D,["prevent"])},[t("div",Ce,[t("div",Se,[c(R,{value:B.value,rows:1,placeholder:s.$t("Recipients")},null,8,["value","placeholder"]),t("span",ke,l(p.users[0]),1)]),f(C).query.id&&f(C).query.name?ae("",!0):(y(),b(te,{key:0},[t("div",we,[t("button",{class:"btns student-c py-2 px-4 w-100",type:"button",onClick:e[0]||(e[0]=o=>g.value=!0)},[Me,$(" "+l(s.$t("Employee")),1)])]),t("div",$e,[t("button",{type:"button",class:"btns c-save py-2 px-4 w-100",onClick:e[1]||(e[1]=o=>h.value=!0)},[Ee,$(" "+l(s.$t("Student")),1)])])],64))]),t("div",Ie,[t("div",Ue,[c(V,{value:a.theme,"onUpdate:value":e[2]||(e[2]=o=>a.theme=o),type:"text",placeholder:s.$t("Topic")},null,8,["value","placeholder"]),t("span",xe,l(p.theme[0]),1)]),t("div",Fe,[t("div",Le,[t("input",{type:"file",id:"file_upload",ref_key:"fileUpload",ref:S,class:"d-none"},null,512),t("label",Oe,l(s.$t("attach_file")),1),t("input",{type:"text",class:"form-control",id:"inputGroupFile01",onClick:G})]),t("span",je,l(p.file[0]),1)])]),c(f(j),{modelValue:a.message,"onUpdate:modelValue":e[3]||(e[3]=o=>a.message=o),editor:f(ie),config:f(de)},null,8,["modelValue","editor","config"]),t("span",Be,l(p.message[0]),1),t("div",De,[t("button",{class:"btns black-c py-2 my-1",type:"button",onClick:N,disabled:r.value},[r.value?(y(),b("span",Ge)):(y(),b("i",Re)),t("span",null,l(s.$t("Save_to_draft")),1)],8,Ne),c(q,{class:"c-filter py-2 px-4 my-1 ms-auto",loading:r.value,icon:"send"},{default:M(()=>[$(l(s.$t("Sent")),1)]),_:1},8,["loading"])])],32),c(K,{"is-open":g.value,"onUpdate:isOpen":e[4]||(e[4]=o=>g.value=o),"selected-employees":i.value,"onUpdate:selectedEmployees":e[5]||(e[5]=o=>i.value=o),"onUpdate:departmentId":e[6]||(e[6]=o=>a.department_id=o)},null,8,["is-open","selected-employees"]),c(T,{"is-open":h.value,"onUpdate:isOpen":e[7]||(e[7]=o=>h.value=o),"selected-students":m.value,"onUpdate:selectedStudents":e[8]||(e[8]=o=>m.value=o),"onUpdate:academicGroupId":e[9]||(e[9]=o=>a.academic_group_id=o)},null,8,["is-open","selected-students"])])])])])])}}});const We=pe(Ve,[["__scopeId","data-v-92c4c090"]]);export{We as default};
