import{_ as Ue,f as Ve,d as H,r as De,a as ze,b as xe,m as Be,c as Te}from"./index.88fda4e6.js";import{A as Oe,B as C,d as z,w as V,i as be,o as s,e as c,f as e,v as Pe,j as L,k as E,t as n,c as O,y as P,F as q,r as J,l as N,a as Y,s as I,z as T,q as G,ab as Le,bs as se,bH as te,b5 as Fe,h as He,u as ye,bO as ke,Z as ie,b0 as de,bS as re,g as ee,aR as ue,c2 as _e,p as me,m as he,C as Ee}from"./index.3390162f.js";import{_ as qe}from"./PageHeader.vue_vue_type_script_setup_true_lang.546c13dd.js";import{_ as K}from"./_plugin-vue_export-helper.cdc0426e.js";import{_ as pe}from"./Pagination.f4a9fc5d.js";import{h as x}from"./helper.569bc08f.js";import"./sweetalert2.all.fdef424e.js";import"./moment.2cad4b18.js";const ne=Oe("messageStore",()=>{const y=C(!1),_=C("");function f($){_.value=$}return{isLoading:y,searchString:_,updateSearchString:f}}),Ye={class:"collapse__block"},Ze={class:"collapse show",id:"collapse-3"},Ge={class:"card p-3"},Je={class:"my-2 col-xl-10 form--item"},Ke={for:"yu"},Qe={class:"my-2 col-xl-2"},We=z({__name:"MessageFilterForm",setup(y){const _=ne(),f=C(""),$=C(!1);V(f,o=>{o===""&&_.updateSearchString(f.value)});async function g(){_.updateSearchString(f.value)}return(o,t)=>{const a=be("a-input"),u=be("a-space"),l=Ue;return s(),c("div",Ye,[e("div",Ze,[e("div",Ge,[e("form",{class:"row",onSubmit:Pe(g,["prevent"])},[e("div",Je,[L(u,null,{default:E(()=>[L(a,{value:f.value,"onUpdate:value":t[0]||(t[0]=w=>f.value=w),id:"yu",class:"form-control","allow-clear":""},null,8,["value"])]),_:1}),e("label",Ke,n(o.$t("Search_by_name")),1)]),e("div",Qe,[L(l,{type:"submit",loading:$.value},null,8,["loading"])])],32)])])])}}}),Xe={class:"d-flex align-items-center"},es={class:"avatar-group me-3"},ss={class:"avatar-group-item"},ts={key:0,href:"javascript: void(0);",class:"d-inline-block"},ns=["src"],as={key:1,class:"avatar-sm"},os={class:"avatar-title rounded-circle bg-success text-white"},ls={key:0,class:"avatar-group-item"},cs={class:"avatar-sm"},is={class:"avatar-title rounded-circle bg-success text-white"},ae=z({__name:"AvatarStack",props:{recipients:{}},emits:["view"],setup(y,{emit:_}){const f=y,$=_,g=O(()=>{const t=[];return f.recipients.forEach(a=>{a.employee?t.push(a.employee):a.student&&t.push(a.student)}),t.length>3?t.splice(0,3):t});P(()=>{});function o(){$("view")}return(t,a)=>{var u;return s(),c("div",Xe,[e("div",es,[(s(!0),c(q,null,J(g.value,l=>{var w;return s(),c("div",ss,[l.image?(s(),c("a",ts,[e("img",{src:l.image,alt:"recipient's image",class:"rounded-circle avatar-sm"},null,8,ns)])):(s(),c("div",as,[e("span",os,n((w=l.full_name[0])==null?void 0:w.toUpperCase()),1)]))])}),256)),t.recipients.length>3?(s(),c("div",ls,[e("div",cs,[e("span",is," +"+n(t.recipients.length-3),1)])])):N("",!0)]),((u=g.value)==null?void 0:u.length)===1?(s(),c("a",{key:0,href:"javascript:;",class:"link-primary",onClick:o},[e("span",null,n(g.value[0].full_name),1)])):N("",!0)])}}}),ds={class:"modal-dialog modal-lg"},rs={key:0,class:"modal-content"},us={class:"modal-header"},_s={class:"modal-body"},ms={class:"list-unstyled mb-0"},hs={class:"chat-day-title mb-4"},ps={class:"lineDate"},gs={class:"title"},vs={class:"messageDate"},fs={class:""},$s={class:"ctext-wrap"},bs={class:"ctext-wrap-content w-100"},ys=["innerHTML"],ks=e("hr",null,null,-1),ws={class:"d-flex justify-content-between"},Ms=e("i",{class:"mdi mdi-delete-sweep"},null,-1),Cs={class:"ms-2"},Ss={class:"btn-group gap-2"},As={type:"button",class:"btn btn-warning rounded-1","data-bs-dismiss":"modal"},Ds=e("i",{class:"mdi mdi-close"},null,-1),js=e("i",{class:"mdi mdi-restore"},null,-1),Ls={class:"ms-2"},Is=z({__name:"DeletedMessageShowModal",props:{message:{}},emits:["closeModal","delete","restore"],setup(y,{emit:_}){const f=y,$=_,{t:g}=Y(),o=C(),t=O(()=>{var l,w,M;return(w=(l=f.message)==null?void 0:l.receivers)!=null&&w.length?(M=f.message)==null?void 0:M.receivers.map(k=>{var m,r,i,b,A,R;return k.employee?((m=k.employee)==null?void 0:m.surname)+" "+((r=k.employee)==null?void 0:r.name)+" "+((i=k.employee)==null?void 0:i.patronymic):k.student?((b=k.student)==null?void 0:b.surname)+" "+((A=k.student)==null?void 0:A.name)+" "+((R=k.student)==null?void 0:R.patronymic):""}).join(", "):g("You")});P(()=>{var l;(l=o.value)==null||l.addEventListener("hidden.bs.modal",w=>{$("closeModal")})});function a(){$("delete")}function u(){$("restore")}return(l,w)=>{var k,m,r;const M=ae;return s(),c("div",{id:"deleted-message-modal",ref_key:"deletedMessageShowModal",ref:o,class:"modal fade",tabindex:"-1","aria-labelledby":"deletedMessageModalLabel","aria-hidden":"false"},[e("div",ds,[l.message?(s(),c("div",rs,[e("div",us,[l.message.receivers.length?(s(),I(M,{key:0,recipients:l.message.receivers},null,8,["recipients"])):N("",!0)]),e("div",_s,[e("ul",ms,[e("li",hs,[e("div",ps,[e("span",gs,n(l.message.created_at),1)])]),e("li",null,[e("div",vs,[e("h5",null,n(l.message.theme),1),e("p",null,[T(n(l.$t("From"))+": ",1),e("span",null,[e("b",null,n((k=l.message.sender)==null?void 0:k.surname)+" "+n((m=l.message.sender)==null?void 0:m.name)+" "+n((r=l.message.sender)==null?void 0:r.patronymic),1)])]),e("p",null,[T(n(l.$t("To_recipient"))+": ",1),e("span",fs,[e("b",null,n(t.value),1)])])]),e("div",$s,[e("div",bs,[e("span",{innerHTML:l.message.message},null,8,ys)])]),ks])]),e("div",ws,[e("button",{type:"button",class:"btn btn-danger rounded-1",onClick:a},[Ms,e("span",Cs,n(l.$t("Remove")),1)]),e("div",Ss,[e("button",As,[Ds,T(" "+n(l.$t("Close")),1)]),e("button",{type:"button",class:"btn btn-primary rounded-1",onClick:u},[js,e("span",Ls,n(l.$t("Restore")),1)])])])])])):N("",!0)])],512)}}}),Rs={},Ns={class:"row"},Us={class:"col-12"},Vs={class:"d-flex justify-content-center align-items-center",style:{"min-height":"10rem"}},zs={class:"text-center"};function xs(y,_){return s(),c("div",Ns,[e("div",Us,[e("div",Vs,[e("h4",zs,n(y.$t("No_messages")),1)])])])}const ge=K(Rs,[["render",xs]]),we=z({__name:"MdiIcon",props:{color:{default:""},icon:{default:"null"},size:{default:"1rem"}},setup(y){return(_,f)=>(s(),c("i",{class:G(["mdi",_.icon&&`mdi-${_.icon}`,_.color&&`text-${_.color}`]),style:Le({"font-size":_.size})},null,6))}}),Bs={class:"d-flex gap-3 align-items-center"},Ts={class:"form-check my-2"},Os={for:"check-all",class:"form-check-label d-flex gap-2 mt-1"},Ps={key:0},Fs={key:1},Hs={key:2},Es={key:0,class:"btn-group gap-2"},ve=z({__name:"Checker",props:{isAllChecked:{type:Boolean,default:!1},checkedMessagesLength:{default:0}},emits:["update:isAllChecked"],setup(y,{emit:_}){const f=y,$=_,g=O({get(){return f.isAllChecked},set(o){$("update:isAllChecked",o)}});return(o,t)=>(s(),c("div",Bs,[e("div",Ts,[se(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),id:"check-all",class:"form-check-input",type:"checkbox"},null,512),[[te,g.value]]),e("label",Os,[o.checkedMessagesLength?(s(),c("span",Ps,n(o.checkedMessagesLength),1)):N("",!0),o.isAllChecked?(s(),c("span",Fs,n(o.$t("Deselect")),1)):(s(),c("span",Hs,n(o.$t("Select_all")),1))])]),o.checkedMessagesLength>0?(s(),c("div",Es,[Fe(o.$slots,"default")])):N("",!0)]))}}),qs={},Ys={class:"row"},Zs=e("div",{class:"col-12"},[e("div",{class:"d-flex justify-content-center align-items-center",style:{"min-height":"10rem"}},[e("span",{class:"spinner-border",role:"status","aria-hidden":"true"})])],-1),Gs=[Zs];function Js(y,_){return s(),c("div",Ys,Gs)}const fe=K(qs,[["render",Js]]),Me=y=>(me("data-v-3e2890af"),y=y(),he(),y),Ks={key:1,class:"table-responsive"},Qs={class:"content-table"},Ws={class:"justify-content-start"},Xs=Me(()=>e("i",{class:"mdi mdi-delete"},null,-1)),et={class:"ms-2"},st=Me(()=>e("i",{class:"mdi mdi-restore"},null,-1)),tt={class:"ms-2"},nt={class:"table-row-message"},at={class:"form-check text-center"},ot=["value"],lt={key:1,class:"d-flex align-items-center"},ct={class:"avatar-group me-3"},it={class:"avatar-group-item"},dt={class:"avatar-sm"},rt={class:"avatar-title rounded-circle bg-success text-white"},ut=["onClick"],_t={key:1,class:"d-flex align-items-center"},mt={class:"avatar-group me-3"},ht={class:"avatar-group-item"},pt={key:0,href:"javascript: void(0);",class:"d-inline-block"},gt=["src"],vt={key:1,class:"avatar-sm"},ft={class:"avatar-title rounded-circle bg-success text-white"},$t=["onClick"],bt=["onClick"],yt=Me(()=>e("br",null,null,-1)),kt={class:"text-truncate"},wt=["onClick"],Mt=z({__name:"DeletedMessages",setup(y){var D;const _=ne(),$=(D=He().getUser)==null?void 0:D.id;ye();const{t:g}=Y(),o=ke(),t=C(!0),a=C([]),u=C(null),l=ie({current_page:1,last_page:1,data:[],links:[],total:0}),w=O({get(){var v,p,U;return((v=l.data)==null?void 0:v.length)>0&&((p=a.value)==null?void 0:p.length)===((U=l.data)==null?void 0:U.length)},set(v){var p;v?a.value=(p=l.data)==null?void 0:p.map(U=>U.id):a.value=[]}}),M=C(!1),k=new AbortController,m=k.signal;P(async function(){await r()}),de(()=>{k.abort()}),V(M,function(v){const p=re.getOrCreateInstance("#deleted-message-modal");v?p.show():p.hide()}),V(()=>l.current_page,async v=>{Number(v)&&(a.value=[],await r(v))}),V(()=>_.searchString,async v=>{await r(),_.isLoading=!1},{deep:!0});async function r(v=1){t.value=!0;const p={search_string:_.searchString,page:v},U=await Ve(p,m);Object.assign(l,U),t.value=!1}function i(v){M.value=!0,u.value=v}async function b(v){const p=_e.exports.isArray(v)?v:[v];a.value=[],await x.confirmDeletionAction(H,p),await r()}async function A(){const v=u.value;R();const p=[v==null?void 0:v.id];await x.confirmDeletionAction(H,p),await r()}async function R(){M.value=!1,u.value=null}async function h(){try{const v=u.value;R(),t.value=!0,v&&await De([v.id]),await r()}catch{o.error(g("Something_went_wrong"))}finally{t.value=!1}}async function d(){try{t.value=!0,await De(a.value),await r(),a.value=[]}catch{o.error(g("Something_went_wrong"))}finally{t.value=!1}}return(v,p)=>{const U=fe,B=ve,$e=ae,j=we,oe=pe,le=ge,ce=Is;return s(),c("div",null,[t.value?(s(),I(U,{key:0})):l.data.length?(s(),c("div",Ks,[e("table",Qs,[e("tbody",null,[e("tr",null,[e("td",Ws,[L(B,{"is-all-checked":w.value,"onUpdate:isAllChecked":p[1]||(p[1]=S=>w.value=S),"checked-messages-length":a.value.length},{default:E(()=>[e("button",{type:"button",class:"btn btn-danger delete-btn py-1",onClick:p[0]||(p[0]=S=>b(a.value))},[Xs,e("span",et,n(v.$t("Remove")),1)]),e("button",{type:"button",class:"btn btn-primary rounded-1",onClick:d},[st,e("span",tt,n(v.$t("Restore")),1)])]),_:1},8,["is-all-checked","checked-messages-length"])])]),(s(!0),c(q,null,J(l.data,S=>{var Q,W,X,F,Ce,Se,Ae;return s(),c("tr",nt,[e("td",null,[e("div",at,[se(e("input",{"onUpdate:modelValue":p[2]||(p[2]=Z=>a.value=Z),value:S.id,class:"form-check-input",type:"checkbox"},null,8,ot),[[te,a.value]])])]),e("td",null,[((Q=S.sender)==null?void 0:Q.user_id)===ee($)?(s(),c(q,{key:0},[(W=S.receivers)!=null&&W.length?(s(),I($e,{key:0,recipients:S.receivers,onView:Z=>i(S)},null,8,["recipients","onView"])):(s(),c("div",lt,[e("div",ct,[e("div",it,[e("div",dt,[e("span",rt,[L(j,{icon:"account-circle-outline",size:"2.5rem"})])])])]),e("a",{href:"javascript:;",class:"link-primary",onClick:Z=>i(S)},n(v.$t("Not_specified")),9,ut)]))],64)):(s(),c("div",_t,[e("div",mt,[e("div",ht,[(X=S.sender)!=null&&X.image?(s(),c("a",pt,[e("img",{src:(F=S.sender)==null?void 0:F.image,alt:"",class:"rounded-circle avatar-sm"},null,8,gt)])):(s(),c("div",vt,[e("span",ft,n((Se=(Ce=S.sender)==null?void 0:Ce.full_name[0])==null?void 0:Se.toUpperCase()),1)]))])]),e("a",{href:"javascript:;",class:"link-primary",onClick:Z=>i(S)},n((Ae=S.sender)==null?void 0:Ae.full_name),9,$t)]))]),e("td",null,[e("a",{href:"javascript:;",class:"link-dark",onClick:Z=>i(S)},[e("span",null,n(S.theme||v.$t("No_subject")),1),yt,e("span",kt,n(ee(x).truncatedMessage(S.message)),1)],8,bt)]),e("td",null,n(S.created_at),1),e("td",null,[e("button",{class:"btn p-0 border-0 text-danger",type:"button",onClick:Z=>b(S.id)},[L(j,{icon:"delete-outline",size:"1.5rem"})],8,wt)])])}),256))])]),(l==null?void 0:l.last_page)>1?(s(),I(oe,ue({key:0,class:"mt-2"},{...l},{"current-page":l.current_page,"onUpdate:currentPage":p[3]||(p[3]=S=>l.current_page=S),loading:t.value}),null,16,["current-page","loading"])):N("",!0)])):(s(),I(le,{key:2})),L(ce,{message:u.value,onCloseModal:R,onRestore:h,onDelete:A},null,8,["message"])])}}});const Ct=K(Mt,[["__scopeId","data-v-3e2890af"]]),je=z({__name:"MdiIcon",props:{color:{default:""},icon:{default:"null"},size:{default:"1rem"}},setup(y){return(_,f)=>(s(),c("i",{class:G(["mdi",_.icon&&`mdi-${_.icon}`,_.color&&`text-${_.color}`]),style:Le({"font-size":_.size})},null,6))}}),Ie=y=>(me("data-v-0c0eb482"),y=y(),he(),y),St={key:1,class:"table-responsive"},At={class:"content-table"},Dt={class:"justify-content-start"},jt=Ie(()=>e("i",{class:"mdi mdi-delete"},null,-1)),Lt={class:"ms-2"},It={class:"table-row-message"},Rt={class:"form-check text-center"},Nt=["value"],Ut={key:1,class:"d-flex align-items-center"},Vt={class:"avatar-group me-3"},zt={class:"avatar-group-item"},xt={class:"avatar-sm"},Bt={class:"avatar-title rounded-circle bg-success text-white"},Tt=["onClick"],Ot=["onClick"],Pt=Ie(()=>e("br",null,null,-1)),Ft={class:"text-truncate"},Ht=["onClick"],Et=z({__name:"Draft",setup(y){const _=ne(),f=ye();Y(),ke();const $=C(!1),g=C([]);C(null);const o=ie({current_page:1,last_page:1,data:[],links:[],total:0}),t=O({get(){var m,r,i;return((m=o.data)==null?void 0:m.length)>0&&((r=g.value)==null?void 0:r.length)===((i=o.data)==null?void 0:i.length)},set(m){var r;m?g.value=(r=o.data)==null?void 0:r.map(i=>i.id):g.value=[]}}),a=C(!1),u=new AbortController,l=u.signal;P(async function(){await w()}),de(()=>{u.abort()}),V(a,function(m){const r=re.getOrCreateInstance("#incoming-message-modal");m?r.show():r.hide()}),V(()=>o.current_page,async m=>{Number(m)&&(g.value=[],await w(m))}),V(()=>_.searchString,async m=>{await w(),_.isLoading=!1},{deep:!0});async function w(m=1){$.value=!0;const r={search_string:_.searchString,page:m},i=await ze(r,l);Object.assign(o,i),$.value=!1}function M(m){f.push({path:`/messages/${m.id}`})}async function k(m){const r=_e.exports.isArray(m)?m:[m];g.value=[],await x.confirmDeletionAction(H,r),await w()}return(m,r)=>{const i=fe,b=ve,A=ae,R=pe,h=ge;return s(),c("div",null,[$.value?(s(),I(i,{key:0})):o.data.length?(s(),c("div",St,[e("table",At,[e("tbody",null,[e("tr",null,[e("td",Dt,[L(b,{"is-all-checked":t.value,"onUpdate:isAllChecked":r[1]||(r[1]=d=>t.value=d),"checked-messages-length":g.value.length},{default:E(()=>[e("button",{type:"button",class:"btn btn-danger delete-btn py-1",onClick:r[0]||(r[0]=d=>k(g.value))},[jt,e("span",Lt,n(m.$t("Remove")),1)])]),_:1},8,["is-all-checked","checked-messages-length"])])]),(s(!0),c(q,null,J(o.data,d=>(s(),c("tr",It,[e("td",null,[e("div",Rt,[se(e("input",{"onUpdate:modelValue":r[2]||(r[2]=D=>g.value=D),value:d.id,class:"form-check-input",type:"checkbox"},null,8,Nt),[[te,g.value]])])]),e("td",null,[d.receivers.length?(s(),I(A,{key:0,recipients:d.receivers,onView:D=>M(d)},null,8,["recipients","onView"])):(s(),c("div",Ut,[e("div",Vt,[e("div",zt,[e("div",xt,[e("span",Bt,[L(je,{icon:"account-circle-outline",size:"2.5rem"})])])])]),e("a",{href:"javascript:;",class:"link-primary",onClick:D=>M(d)},n(m.$t("Not_specified")),9,Tt)]))]),e("td",null,[e("a",{href:"javascript:;",class:"link-dark",onClick:D=>M(d)},[e("span",null,n(d.theme||m.$t("No_subject")),1),Pt,e("span",Ft,n(ee(x).truncatedMessage(d.message)),1)],8,Ot)]),e("td",null,n(d.created_at),1),e("td",null,[e("button",{class:"btn p-0 border-0 text-danger",type:"button",onClick:D=>k(d.id)},[L(je,{icon:"delete-outline",size:"1.5rem"})],8,Ht)])]))),256))])]),(o==null?void 0:o.last_page)>1?(s(),I(R,ue({key:0,class:"mt-2"},{...o},{"current-page":o.current_page,"onUpdate:currentPage":r[3]||(r[3]=d=>o.current_page=d),loading:$.value}),null,16,["current-page","loading"])):N("",!0)])):(s(),I(h,{key:2}))])}}});const qt=K(Et,[["__scopeId","data-v-0c0eb482"]]),Yt={class:"modal-dialog modal-lg"},Zt={key:0,class:"modal-content"},Gt={class:"modal-header"},Jt={class:"d-flex align-items-center"},Kt={key:0,class:"flex-shrink-0 avatar-sm me-3 d-sm-block"},Qt=["src"],Wt={key:1,class:"avatar-sm me-2"},Xt={class:"avatar-title rounded-circle bg-success text-white"},en={class:"modal-body"},sn={class:"list-unstyled mb-0"},tn={class:"chat-day-title mb-4"},nn={class:"lineDate"},an={class:"title"},on={class:"messageDate"},ln={key:0,class:"mb-3"},cn=["href"],dn={class:"ctext-wrap"},rn={class:"ctext-wrap-content w-100"},un={class:"ctext-wrap"},_n={class:"ctext-wrap-content w-100"},mn=["innerHTML"],hn=e("hr",null,null,-1),pn={class:"d-flex justify-content-between"},gn=e("i",{class:"mdi mdi-delete-sweep"},null,-1),vn={class:"ms-2"},fn={class:"btn-group gap-2"},$n={type:"button",class:"btn btn-warning rounded-1","data-bs-dismiss":"modal"},bn=e("i",{class:"mdi mdi-reply"},null,-1),yn={class:"ms-2"},kn=z({__name:"IncomingMessageShowModal",props:{message:{}},emits:["closeModal","delete","reply"],setup(y,{emit:_}){const f=_;Y();const $=C();P(()=>{var t;(t=$.value)==null||t.addEventListener("hidden.bs.modal",a=>{f("closeModal")})});function g(){f("delete")}function o(){f("reply")}return(t,a)=>{var u,l,w,M,k,m,r,i;return s(),c("div",{id:"incoming-message-modal",ref_key:"incomingMessageModal",ref:$,class:"modal fade",tabindex:"-1","aria-labelledby":"incomingMessageModalLabel","aria-hidden":"false"},[e("div",Yt,[t.message?(s(),c("div",Zt,[e("div",Gt,[e("div",Jt,[(u=t.message.sender)!=null&&u.image?(s(),c("div",Kt,[e("img",{src:(l=t.message.sender)==null?void 0:l.image,alt:"Sender's image",class:"img-fluid d-block rounded-circle"},null,8,Qt)])):(s(),c("div",Wt,[e("span",Xt,n((M=(w=t.message.sender)==null?void 0:w.full_name[0])==null?void 0:M.toUpperCase()),1)]))])]),e("div",en,[e("ul",sn,[e("li",tn,[e("div",nn,[e("span",an,n(t.message.created_at),1)])]),e("li",null,[e("div",on,[e("p",null,[T(n(t.$t("From"))+": ",1),e("span",null,[e("b",null,[T(n((k=t.message.sender)==null?void 0:k.full_name)+" \xA0 ",1),e("span",null,"("+n((i=(r=(m=t.message.sender)==null?void 0:m.user)==null?void 0:r.roles)==null?void 0:i.map(({name:b})=>b).join(", "))+")",1)])])]),e("p",null,[T(n(t.$t("To"))+": ",1),e("span",null,[e("b",null,n(t.$t("to_you")),1)])])]),t.message.file_path?(s(),c("div",ln,[e("a",{href:t.message.file_path},n(t.$t("attached_file")),9,cn)])):N("",!0),e("div",dn,[e("div",rn,[e("h5",null,n(t.message.theme),1)])]),e("div",un,[e("div",_n,[e("span",{innerHTML:t.message.message},null,8,mn)])]),hn])]),e("div",pn,[e("button",{type:"button",class:"btn btn-danger rounded-1",onClick:g},[gn,e("span",vn,n(t.$t("Remove")),1)]),e("div",fn,[e("button",$n,n(t.$t("Close")),1),e("button",{type:"button",class:"btn btn-primary rounded-1",onClick:o},[bn,e("span",yn,n(t.$t("Reply")),1)])])])])])):N("",!0)])],512)}}}),Re=y=>(me("data-v-7ab1f22b"),y=y(),he(),y),wn={key:1,class:"table-responsive"},Mn={class:"content-table"},Cn={class:"justify-content-start"},Sn=Re(()=>e("i",{class:"mdi mdi-delete"},null,-1)),An={class:"ms-2"},Dn={class:"table-row-message"},jn={class:"form-check text-center"},Ln=["value"],In={class:"d-flex align-items-center"},Rn={class:"avatar-group me-3"},Nn={class:"avatar-group-item"},Un={key:0,href:"javascript: void(0);",class:"d-inline-block"},Vn=["src"],zn={key:1,class:"avatar-sm"},xn={class:"avatar-title rounded-circle bg-success text-white"},Bn=["onClick"],Tn=["onClick"],On=Re(()=>e("br",null,null,-1)),Pn={class:"text-truncate"},Fn=["onClick"],Hn=z({__name:"IncomingMessages",setup(y){const _=ne(),f=ye(),{t:$}=Y(),g=ke(),o=C(!1),t=C([]),a=C(null),u=ie({last_page:1,current_page:1,data:[],links:[],total:0}),l=O({get(){var h,d,D;return((h=u.data)==null?void 0:h.length)>0&&((d=t.value)==null?void 0:d.length)===((D=u.data)==null?void 0:D.length)},set(h){var d;h?t.value=(d=u.data)==null?void 0:d.map(D=>D.id):t.value=[]}}),w=C(!1),M=new AbortController,k=M.signal;P(async function(){await m()}),de(()=>{M.abort()}),V(w,function(h){const d=re.getOrCreateInstance("#incoming-message-modal");h?d.show():d.hide()}),V(()=>u.current_page,async h=>{Number(h)&&(t.value=[],await m(h))}),V(()=>_.searchString,async h=>{await m(),_.isLoading=!1},{deep:!0});async function m(h=1){o.value=!0;const d={search_string:_.searchString,page:h},D=await xe(d,k);Object.assign(u,D),o.value=!1}async function r(h){var d;try{if(h.receiver){if(h.receiver.is_seen==!1){const D=await Be((d=h.receiver)==null?void 0:d.id),v=u.data.find(p=>p.id===h.id);v&&(v.receiver.is_seen=!0)}w.value=!0,a.value=h}}catch(D){g.error($("Something_went_wrong",D.message))}}async function i(h){const d=_e.exports.isArray(h)?h:[h];t.value=[],await x.confirmDeletionAction(H,d),await m()}async function b(){const h=a.value;A();const d=[h==null?void 0:h.id];await x.confirmDeletionAction(H,d),await m()}async function A(){w.value=!1,a.value=null}async function R(){const h=a.value;A();const d={id:h==null?void 0:h.sender_id,name:h==null?void 0:h.sender.full_name};f.push({path:"/messages/compose",query:d})}return(h,d)=>{const D=fe,v=ve,p=we,U=pe,B=ge,$e=kn;return s(),c("div",null,[o.value?(s(),I(D,{key:0})):u.data.length?(s(),c("div",wn,[e("table",Mn,[e("tbody",null,[e("tr",null,[e("td",Cn,[L(v,{"is-all-checked":l.value,"onUpdate:isAllChecked":d[1]||(d[1]=j=>l.value=j),"checked-messages-length":t.value.length},{default:E(()=>[e("button",{type:"button",class:"btn btn-danger delete-btn py-1",onClick:d[0]||(d[0]=j=>i(t.value))},[Sn,e("span",An,n(h.$t("Remove")),1)])]),_:1},8,["is-all-checked","checked-messages-length"])])]),(s(!0),c(q,null,J(u.data,j=>{var oe,le,ce,S,Q,W,X;return s(),c("tr",Dn,[e("td",null,[e("div",jn,[se(e("input",{"onUpdate:modelValue":d[2]||(d[2]=F=>t.value=F),value:j.id,class:"form-check-input",type:"checkbox"},null,8,Ln),[[te,t.value]])])]),e("td",null,[e("div",In,[e("div",Rn,[e("div",Nn,[(oe=j.sender)!=null&&oe.image?(s(),c("a",Un,[e("img",{src:(le=j.sender)==null?void 0:le.image,alt:"",class:"rounded-circle avatar-sm"},null,8,Vn)])):(s(),c("div",zn,[e("span",xn,n((S=(ce=j.sender)==null?void 0:ce.full_name[0])==null?void 0:S.toUpperCase()),1)]))])]),e("a",{href:"javascript:;",class:G(["link-primary",!((Q=j.receiver)!=null&&Q.is_seen)&&"fw-bold"]),onClick:F=>r(j)},n((W=j.sender)==null?void 0:W.full_name),11,Bn)])]),e("td",null,[e("a",{href:"javascript:;",class:G(["link-dark",!((X=j.receiver)!=null&&X.is_seen)&&"fw-bold"]),onClick:F=>r(j)},[e("span",null,n(j.theme||h.$t("No_subject")),1),On,e("span",Pn,n(ee(x).truncatedMessage(j.message)),1)],10,Tn)]),e("td",null,n(j.created_at),1),e("td",null,[e("button",{class:"btn p-0 border-0 text-danger",type:"button",onClick:F=>i(j.id)},[L(p,{icon:"delete-outline",size:"1.5rem"})],8,Fn)])])}),256))])]),(u==null?void 0:u.last_page)>1?(s(),I(U,ue({key:0,class:"mt-2"},{...u},{"current-page":u.current_page,"onUpdate:currentPage":d[3]||(d[3]=j=>u.current_page=j),loading:o.value}),null,16,["current-page","loading"])):N("",!0)])):(s(),I(B,{key:2})),L($e,{message:a.value,onCloseModal:A,onDelete:b,onReply:R},null,8,["message"])])}}});const En=K(Hn,[["__scopeId","data-v-7ab1f22b"]]),qn={class:"modal-dialog modal-lg"},Yn={key:0,class:"modal-content"},Zn={class:"modal-header"},Gn={class:"modal-body"},Jn={class:"list-unstyled mb-0"},Kn={class:"chat-day-title mb-4"},Qn={class:"lineDate"},Wn={class:"title"},Xn={class:"messageDate"},ea={class:""},sa={key:0,class:"mb-3"},ta=["href"],na={class:"ctext-wrap"},aa={class:"ctext-wrap-content w-100"},oa={class:"ctext-wrap"},la={class:"ctext-wrap-content w-100"},ca=["innerHTML"],ia=e("hr",null,null,-1),da={class:"d-flex justify-content-between"},ra=e("i",{class:"mdi mdi-delete-sweep"},null,-1),ua={class:"ms-2"},_a={class:"btn-group gap-2"},ma={type:"button",class:"btn btn-warning rounded-1","data-bs-dismiss":"modal"},ha=z({__name:"SentMessageShowModal",props:{message:{}},emits:["closeModal","delete"],setup(y,{emit:_}){const f=y,$=_,g=C(),o=O(()=>{var a;return(a=f.message)==null?void 0:a.receivers.map(u=>{var l,w,M,k,m,r,i,b,A,R;if(u.employee){const h=(w=(l=u.employee)==null?void 0:l.user)!=null&&w.roles.length?`(${(m=(k=(M=u.employee)==null?void 0:M.user)==null?void 0:k.roles)==null?void 0:m.map(d=>d.name).join(", ")})`:"";return`${(r=u.employee)==null?void 0:r.full_name} ${h}`}return u.student?`${(i=u.student)==null?void 0:i.full_name} (${(R=(A=(b=u.student)==null?void 0:b.academic_group)==null?void 0:A.name)!=null?R:""})`:""}).join(", ")});P(()=>{var a;(a=g.value)==null||a.addEventListener("hidden.bs.modal",u=>{$("closeModal")})});function t(){$("delete")}return(a,u)=>{const l=ae;return s(),c("div",{id:"sent-message-modal",ref_key:"sentMessageShowModal",ref:g,class:"modal fade",tabindex:"-1","aria-labelledby":"sentMessageModalLabel","aria-hidden":"false"},[e("div",qn,[a.message?(s(),c("div",Yn,[e("div",Zn,[a.message.receivers.length?(s(),I(l,{key:0,recipients:a.message.receivers},null,8,["recipients"])):N("",!0)]),e("div",Gn,[e("ul",Jn,[e("li",Kn,[e("div",Qn,[e("span",Wn,n(a.message.created_at),1)])]),e("li",null,[e("div",Xn,[e("p",null,[T(n(a.$t("From"))+": ",1),e("span",null,[e("b",null,n(a.$t("You")),1)])]),e("p",null,[T(n(a.$t("To"))+": ",1),e("span",ea,[e("b",null,n(o.value),1)])])]),a.message.file_path?(s(),c("div",sa,[e("a",{href:a.message.file_path,download:""},n(a.$t("attached_file")),9,ta)])):N("",!0),e("div",na,[e("div",aa,[e("h5",null,n(a.message.theme),1)])]),e("div",oa,[e("div",la,[e("span",{innerHTML:a.message.message},null,8,ca)])]),ia])]),e("div",da,[e("button",{type:"button",class:"btn btn-danger rounded-1",onClick:t},[ra,e("span",ua,n(a.$t("Remove")),1)]),e("div",_a,[e("button",ma,n(a.$t("Close")),1)])])])])):N("",!0)])],512)}}}),Ne=y=>(me("data-v-b2d26b32"),y=y(),he(),y),pa={key:1,class:"table-responsive"},ga={class:"content-table"},va={class:"justify-content-start"},fa=Ne(()=>e("i",{class:"mdi mdi-delete"},null,-1)),$a={class:"ms-2"},ba={class:"table-row-message"},ya={class:"form-check text-center"},ka=["value"],wa={key:1,class:"d-flex align-items-center"},Ma={class:"avatar-group me-3"},Ca={class:"avatar-group-item"},Sa={class:"avatar-sm"},Aa={class:"avatar-title rounded-circle bg-success text-white"},Da=["onClick"],ja=["onClick"],La=Ne(()=>e("br",null,null,-1)),Ia={class:"text-truncate"},Ra=["onClick"],Na=z({__name:"SentMessages",setup(y){const _=ne();Y();const f=C(!1),$=C([]),g=C(null),o=ie({current_page:1,last_page:1,data:[],links:[],total:0}),t=O({get(){var i,b,A;return((i=o.data)==null?void 0:i.length)>0&&((b=$.value)==null?void 0:b.length)===((A=o.data)==null?void 0:A.length)},set(i){var b;i?$.value=(b=o.data)==null?void 0:b.map(A=>A.id):$.value=[]}}),a=C(!1),u=new AbortController,l=u.signal;P(async function(){await w()}),de(()=>{u.abort()}),V(a,function(i){const b=re.getOrCreateInstance("#sent-message-modal");i?b.show():b.hide()}),V(()=>o.current_page,async i=>{Number(i)&&($.value=[],await w(i))}),V(()=>_.searchString,async i=>{await w(),_.isLoading=!1},{deep:!0});async function w(i=1){f.value=!0;const b={search_string:_.searchString,page:i},A=await Te(b,l);Object.assign(o,A),f.value=!1}function M(i){r(),a.value=!0,g.value=i}async function k(i){const b=_e.exports.isArray(i)?i:[i];$.value=[],await x.confirmDeletionAction(H,b),await w()}async function m(){const i=g.value;r();const b=[i==null?void 0:i.id];await x.confirmDeletionAction(H,b),await w()}async function r(){a.value=!1,g.value=null}return(i,b)=>{const A=fe,R=ve,h=we,d=pe,D=ge,v=ha;return s(),c("div",null,[f.value?(s(),I(A,{key:0})):o.data.length?(s(),c("div",pa,[e("table",ga,[e("tbody",null,[e("tr",null,[e("td",va,[L(R,{"is-all-checked":t.value,"onUpdate:isAllChecked":b[1]||(b[1]=p=>t.value=p),"checked-messages-length":$.value.length},{default:E(()=>[e("button",{type:"button",class:"btn btn-danger delete-btn py-1",onClick:b[0]||(b[0]=p=>k($.value))},[fa,e("span",$a,n(i.$t("Remove")),1)])]),_:1},8,["is-all-checked","checked-messages-length"])])]),(s(!0),c(q,null,J(o.data,p=>{var U;return s(),c("tr",ba,[e("td",null,[e("div",ya,[se(e("input",{"onUpdate:modelValue":b[2]||(b[2]=B=>$.value=B),value:p.id,class:"form-check-input",type:"checkbox"},null,8,ka),[[te,$.value]])])]),e("td",null,[(U=p.receivers)!=null&&U.length?(s(),I(ae,{key:0,recipients:p.receivers,onView:B=>M(p)},null,8,["recipients","onView"])):(s(),c("div",wa,[e("div",Ma,[e("div",Ca,[e("div",Sa,[e("span",Aa,[L(h,{icon:"account-circle-outline",size:"2.5rem"})])])])]),e("a",{href:"javascript:;",class:"link-primary",onClick:B=>M(p)},n(i.$t("Not_specified")),9,Da)]))]),e("td",null,[e("a",{href:"javascript:;",class:"link-dark",onClick:B=>M(p)},[e("span",null,n(p.theme||i.$t("No_subject")),1),La,e("span",Ia,n(ee(x).truncatedMessage(p.message)),1)],8,ja)]),e("td",null,n(p.created_at),1),e("td",null,[e("button",{class:"btn p-0 border-0 text-danger",type:"button",onClick:B=>k(p.id)},[L(h,{icon:"delete-outline",size:"1.5rem"})],8,Ra)])])}),256))])]),(o==null?void 0:o.last_page)>1?(s(),I(d,ue({key:0,class:"mt-2"},{...o},{"current-page":o.current_page,"onUpdate:currentPage":b[3]||(b[3]=p=>o.current_page=p),loading:f.value}),null,16,["current-page","loading"])):N("",!0)])):(s(),I(D,{key:2})),L(v,{message:g.value,onCloseModal:r,onDelete:m},null,8,["message"])])}}});const Ua=K(Na,[["__scopeId","data-v-b2d26b32"]]),Va={class:"myMessagePage"},za=e("i",{class:"mdi mdi-comment me-2"},null,-1),xa={type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse-3",class:"btns c-search px-4"},Ba=e("i",{class:"mdi mdi-filter me-1"},null,-1),Ta={class:"card"},Oa={class:"card-message"},Pa={class:"nav nav-tabs nav-tabs-custom nav-justified",role:"tablist"},Fa=["data-bs-target","aria-controls","onClick"],Ha={class:"icon-text-none"},Ea={class:"tab-content p-4"},Xa=z({__name:"index",setup(y){const{locale:_,t:f}=Y(),$=C({incoming:{slug:"incoming",iconClasses:"mdi mdi-inbox-arrow-down me-2",title:f("Incoming_messages")},sent:{slug:"sent",iconClasses:"mdi mdi-inbox-arrow-up me-2",title:f("Sent_messages")},draft:{slug:"draft",iconClasses:"mdi mdi-email-open me-2",title:f("Draft")},deleted:{slug:"deleted",iconClasses:"mdi mdi-delete-variant me-2",title:f("Deleted_messages")}}),g=C({slug:"incoming",iconClasses:"mdi mdi-inbox-arrow-down me-2",title:f("Incoming_messages")}),o={incoming:En,sent:Ua,draft:qt,deleted:Ct},t=O(()=>o[g.value.slug]);return(a,u)=>{const l=be("RouterLink"),w=qe,M=We;return s(),c("div",Va,[L(w,{title:a.$t("My_messages")},{default:E(()=>[L(l,{to:"/messages/compose",class:"btns c-save px-4 me-3"},{default:E(()=>[za,T(" "+n(a.$t("Compose_message")),1)]),_:1}),e("button",xa,[Ba,e("span",null,n(a.$t("Filter")),1)])]),_:1},8,["title"]),L(M),e("div",Ta,[e("div",Oa,[e("ul",Pa,[(s(!0),c(q,null,J($.value,k=>(s(),c("li",{key:k,class:"nav-item",role:"presentation"},[e("button",{class:G(["nav-link",k.slug===g.value.slug&&"active"]),type:"button","data-bs-toggle":"tab","data-bs-target":"#"+k.slug,"aria-controls":k.slug,"aria-selected":"true",role:"tab",onClick:m=>g.value=k},[e("i",{class:G(k.iconClasses)},null,2),e("span",Ha,n(k.title),1)],10,Fa)]))),128))])]),e("div",Ea,[(s(),I(Ee(t.value)))])])])}}});export{Xa as default};
