import{_ as ae}from"./SubmitButton.vue_vue_type_script_setup_true_lang.fe21b651.js";import{v as te,x as se,y as le,z as oe,A as Z,B as ie,C as ne}from"./index.30e99442.js";import{bR as de,d as re,c as L,B as y,Z as k,y as ue,w,i as T,o as c,s as ce,k as q,f as s,t as o,j as p,g as E,e as m,l as h,z as me,r as O,F as N}from"./index.3390162f.js";import{h as F}from"./helper.569bc08f.js";const _e=de();async function I(A){try{const{data:$}=await _e({url:"/api/references/rating-grades/curriculum",method:"GET",params:A});return $}catch($){throw $}}const pe={class:"row"},ve={class:"modal-title modal-data-tip mb-2"},ye={class:"col-md-6 mb-3"},be={for:"division-name-select",class:"form-label"},fe={key:0,class:"text-danger small"},he={class:"col-md-6 mb-3"},ge={for:"division-name-select",class:"form-label"},je=s("i",{class:"mdi mdi-plus me-2 align-middle"},null,-1),$e={class:"col-md-12"},Ce={class:"col-md-6 mb-3",name:["subjects","subject_id"]},ke={for:"division-name-select",class:"form-label"},we={key:0,class:"text-danger small"},Ee={class:"col-md-5 mb-3",name:["subjects","department_id"]},Fe={for:"division-name-select",class:"form-label"},Se={key:0,class:"text-danger small"},Ue={class:"col-md-1 mt-4"},Be=["disabled","onClick"],Le=s("i",{class:"mdi mdi-delete-sweep text-danger font-size-16 align-middle me-1"},null,-1),Te=[Le],Oe={class:"mb-3 col-md-4"},Ne={for:"division-name-select",class:"form-label"},Ae={key:0,class:"text-danger small"},xe={class:"mb-3 col-md-4"},De={for:"division-name-select",class:"form-label"},Ge={key:0,class:"text-danger small"},Ve={class:"mb-3 col-md-2"},ze={for:"division-name-input",class:"form-label"},Re={key:0,class:"text-danger small"},Pe={class:"mb-3 col-md-2"},He={for:"division-name-input",class:"form-label"},Me={key:0,class:"row"},Ze={class:"modal-title modal-data-tip mb-2"},qe={class:"mb-3 col-md-4"},Ie={for:"division-name-input",class:"form-label"},Je={name:["audience_hours","lesson_activity_id"]},Ke={for:"division-name-input",class:"form-label"},Qe={class:"row"},We={class:"modal-title modal-data-tip mb-2"},Xe={name:["additional_types","additional_type_id"]},Ye={for:"division-name-input",class:"form-label"},ea={class:"row"},aa={class:"modal-title modal-data-tip mb-2"},ta={name:["exam_types","exam_type_id"]},sa={for:"division-name-input",class:"form-label"},la={key:0,class:"text-danger small"},oa={class:"d-flex justify-content-end mt-2"},ua=re({__name:"SubjectForm",props:{formState:{},errors:{},isLoading:{type:Boolean}},emits:["submit","update:formState","clearError"],setup(A,{emit:$}){const J=A,b=$,l=L({get(){return J.formState},set(e){b("update:formState",e)}}),K=y([]),g=y([]),G=y([]),Q=y([]),V=y([]),z=y([]),R=y([]),j=k({rating_grade_lesson_activities:[],rating_grade_additionals:[],rating_grade_exam_types:[]}),P=y({}),S=y(!1),H=y({}),M=L(()=>{var e;return(e=B.audience_hours)==null?void 0:e.reduce((a,i)=>a+i.value*1,0)}),W=L(()=>{var e;return(e=U.additional_types)==null?void 0:e.reduce((a,i)=>a+i.value*1,0)}),x=L(()=>(M.value+W.value)*1);ue(async()=>{Promise.all([te(),se(),le(),oe(),Z(),ie()]).then(async e=>{var a,i,d;if(K.value=e[0].result,g.value=e[1].result,G.value=e[2].result,Q.value=e[3].result,V.value=e[4].result,l.value.type=(a=l.value.type)!=null?a:e[4].result[1].id,R.value=e[5].result,l.value.ratinggrade_id){let u=(d=(i=(await I()).result)==null?void 0:i.data)==null?void 0:d.find(_=>{var t;return _.id==((t=g.value.data)==null?void 0:t.find(r=>r.id==l.value.ratinggrade_id).id)});Object.assign(j,u)}else l.value.ratinggrade_id=e[1].result.data[0].id})}),w(()=>l.value.ratinggrade_id,async e=>{var d;const a=await I();let i=(d=a==null?void 0:a.result)==null?void 0:d.data.find(n=>{var u;return n.id==((u=g==null?void 0:g.value)==null?void 0:u.data.find(_=>_.id==e).id)});Object.assign(j,i)}),w(()=>l.value.type,async e=>{var d,n;const a=await Z();let i=(n=(d=a==null?void 0:a.result)==null?void 0:d.find(u=>u.id==e))==null?void 0:n.code;if(P.value=i,P.value==12?(S.value=!1,H.value=1):(S.value=!0,H.value=2),e){const u=await ne();z.value=u.result}},{immediate:!0});const C=k({subjects:l.value.subjects.map(e=>({subject_id:e.subject_id,department_id:e.department_id}))}),D=k({exam_types:[]});w(()=>j.rating_grade_exam_types,e=>{Object.assign(D,{exam_types:e.map(a=>{var i,d,n;return{exam_type_name:(i=a.exam_type)==null?void 0:i.name,exam_type_id:(d=a.exam_type)==null?void 0:d.id,value:l.value.exam_types.length>0?(n=l.value.exam_types.find(u=>{var _;return u.exam_type.id==((_=a.exam_type)==null?void 0:_.id)}))==null?void 0:n.value:null}})})});const U=k({additional_types:[]});w(()=>j.rating_grade_additionals,e=>{Object.assign(U,{additional_types:e.map(a=>{var i,d,n;return{additional_type_name:(i=a.additional_type)==null?void 0:i.name,additional_type_id:(d=a.additional_type)==null?void 0:d.id,value:l.value.additional_types.length>0?(n=l.value.additional_types.find(u=>{var _;return u.additional_type.id==((_=a.additional_type)==null?void 0:_.id)}))==null?void 0:n.value:"0"}})})});const B=k({audience_hours:[]});w(()=>j.rating_grade_lesson_activities,e=>{Object.assign(B,{audience_hours:e.map((a,i)=>{var d,n,u,_;return{lesson_activity_name:(d=a.lesson_activity)==null?void 0:d.name,lesson_activity_id:(n=a.lesson_activity)==null?void 0:n.id,value:l.value.audience_hours.length>0&&(_=(u=l.value.audience_hours.find(t=>{var r,v,f;return((r=t.lesson_activity)==null?void 0:r.id)!=null&&((v=t.lesson_activity)==null?void 0:v.id)==((f=a.lesson_activity)==null?void 0:f.id)}))==null?void 0:u.value)!=null?_:0}})})});const X=e=>{let a=C.subjects.indexOf(e);a!==-1&&C.subjects.splice(a,1)},Y=()=>{C.subjects.push({subject_id:null,department_id:null})};function ee(){l.value.audience_hours=B.audience_hours,l.value.exam_types=D.exam_types,l.value.additional_types=U.additional_types,l.value.subjects=C.subjects,l.value.total_load=x.value,b("submit")}return(e,a)=>{const i=T("a-select"),d=T("a-button"),n=T("a-input"),u=ae,_=T("a-form");return c(),ce(_,{onFinish:ee,model:l.value},{default:q(()=>[s("div",pe,[s("h5",ve,o(e.$t("Curriculum_Subject_Detail")),1),s("div",ye,[s("label",be,o(e.$t("sciense_type")),1),p(i,{"filter-option":E(F).filterOptionByName,"show-search":"",value:l.value.type,"onUpdate:value":a[0]||(a[0]=t=>l.value.type=t),options:V.value,"field-names":{value:"id",label:"name"},onChange:a[1]||(a[1]=t=>b("clearError","type")),placeholder:e.$t("Choose")},null,8,["filter-option","value","options","placeholder"]),e.errors.type?(c(),m("span",fe,o(e.errors.type[0]),1)):h("",!0)]),s("div",he,[s("div",null,[s("label",ge,o(e.$t("Add_subject")),1),p(d,{disabled:S.value,type:"dashed",block:"",onClick:Y},{default:q(()=>[je,me(" "+o(e.$t("add")),1)]),_:1},8,["disabled"])])]),s("div",$e,[(c(!0),m(N,null,O(C.subjects,(t,r)=>{var v;return c(),m("div",{class:"row bg-light",key:t.id},[s("div",Ce,[s("label",ke,o(e.$t("Subject")),1),p(i,{"filter-option":E(F).filterOptionByName,"show-search":"",options:(v=z.value)==null?void 0:v.data,"field-names":{value:"id",label:"name"},onChange:f=>b("clearError",`subjects.${r}.subject_id`),placeholder:e.$t("Choose"),value:t.subject_id,"onUpdate:value":f=>t.subject_id=f},null,8,["filter-option","options","onChange","placeholder","value","onUpdate:value"]),e.errors[`subjects.${r}.subject_id`]?(c(),m("span",we,o(e.errors[`subjects.${r}.subject_id`][0]),1)):h("",!0)]),s("div",Ee,[s("label",Fe,o(e.$t("Hei_department")),1),p(i,{"filter-option":E(F).filterOptionByName,"show-search":"",options:R.value,"field-names":{value:"id",label:"name"},onChange:f=>b("clearError",`subjects.${r}.department_id`),placeholder:e.$t("Choose"),value:t.department_id,"onUpdate:value":f=>t.department_id=f},null,8,["filter-option","options","onChange","placeholder","value","onUpdate:value"]),e.errors[`subjects.${r}.department_id`]?(c(),m("span",Se,o(e.errors[`subjects.${r}.department_id`][0]),1)):h("",!0)]),s("div",Ue,[s("button",{disabled:S.value,type:"button",class:"btns c-clear me-1 w-100",onClick:f=>X(t)},Te,8,Be)])])}),128))]),s("div",Oe,[s("label",Ne,o(e.$t("Curriculum_Rating_Grade")),1),p(i,{"filter-option":E(F).filterOptionByName,"show-search":"",value:l.value.ratinggrade_id,"onUpdate:value":a[2]||(a[2]=t=>l.value.ratinggrade_id=t),options:g.value.data,"field-names":{value:"id",label:"name"},onChange:a[3]||(a[3]=t=>b("clearError","ratinggrade_id")),placeholder:e.$t("Choose")},null,8,["filter-option","value","options","placeholder"]),e.errors.ratinggrade_id?(c(),m("span",Ae,o(e.errors.ratinggrade_id[0]),1)):h("",!0)]),s("div",xe,[s("label",De,o(e.$t("Exam_Finish")),1),p(i,{"filter-option":E(F).filterOptionByName,"show-search":"",value:l.value.final_exam_type_id,"onUpdate:value":a[4]||(a[4]=t=>l.value.final_exam_type_id=t),options:G.value,"field-names":{value:"id",label:"name"},onChange:a[5]||(a[5]=t=>b("clearError","final_exam_type_id")),placeholder:e.$t("Choose")},null,8,["filter-option","value","options","placeholder"]),e.errors.final_exam_type_id?(c(),m("span",Ge,o(e.errors.final_exam_type_id[0]),1)):h("",!0)]),s("div",Ve,[s("label",ze,o(e.$t("Credit")),1),p(n,{value:l.value.credit,"onUpdate:value":a[6]||(a[6]=t=>l.value.credit=t),onChange:a[7]||(a[7]=t=>b("clearError","credit"))},null,8,["value"]),e.errors.credit?(c(),m("span",Re,o(e.errors.credit[0]),1)):h("",!0)]),s("div",Pe,[s("label",He,o(e.$t("Total_Acload")),1),p(n,{disabled:"",value:x.value,"onUpdate:value":a[8]||(a[8]=t=>x.value=t)},null,8,["value"])]),s("div",null,[j.rating_grade_lesson_activities.length?(c(),m("div",Me,[s("h5",Ze,o(e.$t("Auditorm_hour")),1),s("div",qe,[s("label",Ie,o(e.$t("Total_Point")),1),p(n,{disabled:"",value:M.value},null,8,["value"])]),(c(!0),m(N,null,O(B.audience_hours,(t,r)=>(c(),m("div",{class:"mb-3 col-md-2",key:r},[s("div",Je,[s("label",Ke,o(t.lesson_activity_name),1),p(n,{value:t.value,"onUpdate:value":v=>t.value=v},null,8,["value","onUpdate:value"])])]))),128))])):h("",!0),s("div",Qe,[s("h5",We,o(e.$t("additional")),1),(c(!0),m(N,null,O(U.additional_types,(t,r)=>(c(),m("div",{class:"mb-3 col-md-4",key:t.id},[s("div",Xe,[s("label",Ye,o(t.additional_type_name),1),p(n,{value:t.value,"onUpdate:value":v=>t.value=v},null,8,["value","onUpdate:value"])])]))),128))]),s("div",ea,[s("h5",aa,o(e.$t("Rating_Grades")),1),(c(!0),m(N,null,O(D.exam_types,(t,r)=>(c(),m("div",{class:"mb-3 col-md-4",key:t.id},[s("div",ta,[s("label",sa,o(t.exam_type_name),1),p(n,{value:t.value,"onUpdate:value":v=>t.value=v,onChange:v=>b("clearError",`exam_types.${r}.value`)},null,8,["value","onUpdate:value","onChange"]),e.errors[`exam_types.${r}.value`]?(c(),m("span",la,o(e.errors[`exam_types.${r}.value`][0]),1)):h("",!0)])]))),128))]),s("div",oa,[p(u,{loading:e.isLoading,icon:"content-save"},null,8,["loading"])])])])]),_:1},8,["model"])}}});export{ua as _};
