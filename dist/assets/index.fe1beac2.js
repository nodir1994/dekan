import{bR as E,d as z,h as M,c as W,a as Z,B as C,bq as L,Z as q,w as D,i as g,b6 as x,o as c,e as u,f as e,t as a,z as y,bs as G,j as d,k as f,v as H,g as J,s as F,l as P,F as K,r as Q,aR as X,q as Y}from"./index.3390162f.js";import{f as ee}from"./index.30e99442.js";import{P as te}from"./PaginationForStatistical.bc37bc8c.js";import{_ as ae}from"./LoadingOverlay.vue_vue_type_script_setup_true_lang.89ce9ad6.js";/* empty css                                                       */import{_ as se}from"./NoData.ac42776e.js";import{h as T}from"./helper.569bc08f.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./vue.runtime.esm-bundler.84001772.js";/* empty css                                                               */import"./sweetalert2.all.fdef424e.js";import"./moment.2cad4b18.js";const S=E();async function ne(v){try{const{data:l}=await S({url:"/api/report/active-teachers",params:v});return l}catch(l){throw l}}async function oe(v){try{const{data:l}=await S({url:"/api/report/teacher-export",params:v,responseType:"blob"});return l}catch(l){throw l}}const le={pagetitle:"`O'qituvchi faolligi`",class:"reportByTeacherPage"},ie={class:"card panel-header-bg"},re={class:"card-body"},ce={class:"panel-header"},de={class:"card-title"},ue={class:"panel-toggles"},pe=e("i",{class:"mdi mdi-download me-2"},null,-1),_e={class:"filterBlock"},me={class:"btns c-filter py-1.5 px-4"},he=e("i",{class:"mdi mdi-filter me-2"},null,-1),ge={class:"collapse__block"},fe={class:"my-2 col-md-3 form--item"},ve={for:"yu"},be={class:"my-2 col-md-3 form--item"},ye={for:"yu"},we={class:"my-2 col-md-4 form--item"},$e={for:"yu"},ke={class:"my-2 col-md-2"},Ne={type:"submit",class:"btn-search search-color"},Ce=e("i",{class:"mdi mdi-magnifying-glass me-2"},null,-1),Pe={class:"row table-division"},Be={class:"col-md-12"},Le={class:"card"},qe={class:"card-body"},De={key:1,class:"table-responsive"},Fe={class:"content-table"},Te={class:"table-row d-grid w-100"},Se=e("th",null,[e("b",null,"#")],-1),Ue={key:2,class:"table-responsive"},Re={key:0},He=z({__name:"index",async setup(v){let l,b;const w=M(),U=W(()=>{var t,o;return(o=(t=w==null?void 0:w.user)==null?void 0:t.faculty)==null?void 0:o.name}),{t:R}=Z(),p=C(!1),I=([l,b]=L(()=>ee().then(t=>t.result)),l=await l,b(),l),$=C(!0),n=q({faculy_id:null,department_id:null,search:"",page:1,per_page:T.pagePer}),_=C({sequenceNumber:null,theNumber:null,sorting:null}),s=q({pagination:{current_page:1,per_page:n.per_page,loading:!1},result:[]});[l,b]=L(()=>m()),await l,b(),D(()=>s.pagination.current_page,async t=>{Number(t)&&(n.page=Number(t),await m(t))}),D(()=>n.department_id,async(t,o)=>{await m()});async function O(){n.search!=""&&n.search,n.department_id&&n.department_id;try{p.value=!0;const t=await oe(n),o=URL.createObjectURL(new Blob([t],{type:"application/vnd.ms-excel"})),r=document.createElement("a");r.href=o,r.setAttribute("download",`Worksheet_${Date.now()}.xlsx`),document.body.appendChild(r),r.click()}catch(t){console.log({error:t})}finally{p.value=!1}}async function V(){await m()}async function m(t){let o={page:t||1,per_page:n.per_page};n.search!=""&&(o.search=n.search),n.department_id&&(o.department_id=n.department_id),n.faculy_id&&(o.faculy_id=n.faculy_id);try{if($.value){$.value=!1,p.value=!0;const N=await ne(o);Object.assign(s,N),setTimeout(()=>{$.value=!0},T.loaderRefresh)}let r=`${s.pagination.per_page*(s.pagination.current_page-1)+1}- ${s.result.length+s.pagination.per_page*(s.pagination.current_page-1)}`,h=`${R("Total_Point")} : ${s.pagination.total}`,k=s.pagination.per_page*(s.pagination.current_page-1);_.value.sequenceNumber=r,_.value.theNumber=h,_.value.sorting=k}catch(r){console.log(r)}finally{p.value=!1}}return(t,o)=>{const r=g("a-select"),h=g("a-space"),k=g("a-input"),N=g("b-card"),j=g("b-collapse"),A=x("b-toggle");return c(),u("div",le,[e("div",ie,[e("div",re,[e("div",ce,[e("h5",de,a(t.$t("Teacher_activity")),1),e("div",ue,[e("button",{onClick:o[0]||(o[0]=i=>O()),class:"btns c-save py-1.5 px-4 me-3",type:"submit"},[pe,y(a(t.$t("Export")),1)]),e("div",_e,[G((c(),u("button",me,[he,y(a(t.$t("Filtr")),1)])),[[A,void 0,void 0,{"collapse-3":!0}]])])])])])]),e("div",ge,[d(j,{visible:"",id:"collapse-3"},{default:f(()=>[d(N,null,{default:f(()=>[e("form",{class:"row",onSubmit:H(V,["prevent"])},[e("div",fe,[d(h,null,{default:f(()=>[d(r,{class:"form--item",value:U.value,disabled:""},null,8,["value"])]),_:1}),e("label",ve,a(t.$t("Select_the_faculty")),1)]),e("div",be,[d(h,null,{default:f(()=>[d(r,{value:n.department_id,"onUpdate:value":o[1]||(o[1]=i=>n.department_id=i),options:J(I),"field-names":{value:"id",label:"name"},allowClear:""},null,8,["value","options"])]),_:1}),e("label",ye,a(t.$t("Select_a_cathedra")),1)]),e("div",we,[d(h,null,{default:f(()=>[d(k,{allowClear:"",id:"yu",class:"form-control",value:n.search,"onUpdate:value":o[2]||(o[2]=i=>n.search=i)},null,8,["value"])]),_:1}),e("label",$e,a(t.$t("Full_name"))+" / "+a(t.$t("Passport"))+" / "+a(t.$t("By_employee_ID"))+" "+a(t.$t("search")),1)]),e("div",ke,[e("button",Ne,[Ce,y(a(t.$t("search")),1)])])],32)]),_:1})]),_:1})]),e("div",Pe,[e("div",Be,[e("div",Le,[e("div",qe,[p.value?(c(),F(ae,{key:0})):P("",!0),s.result.length?(c(),u("div",De,[e("table",Fe,[e("thead",null,[e("tr",Te,[Se,e("th",null,[e("b",null,a(t.$t("employee")),1)]),e("th",null,[e("b",null,a(t.$t("cathedra")),1)]),e("th",null,[e("b",null,a(t.$t("IP_address")),1)]),e("th",null,[e("b",null,a(t.$t("Message")),1)]),e("th",null,[e("b",null,a(t.$t("Date_of_entry")),1)])])]),e("tbody",null,[(c(!0),u(K,null,Q(s.result,(i,B)=>(c(),u("tr",{class:"table-row d-grid w-100",key:B},[e("td",null,a((s.pagination.current_page-1)*s.pagination.per_page+B+1),1),e("td",null,a(i.full_name),1),e("td",null,a(i.department),1),e("td",null,a(i.ip)+" "+a(i.id),1),e("td",null,a(i.message),1),e("td",null,a(i.date),1)]))),128))])]),s.pagination.last_page>1?(c(),F(te,X({key:0,class:"mt-2"},{...s.pagination},{"current-page":s.pagination.current_page,"onUpdate:currentPage":o[3]||(o[3]=i=>s.pagination.current_page=i),loading:p.value,onOnPageChange:m}),null,16,["current-page","loading"])):P("",!0)])):(c(),u("div",Ue,[d(se)]))])])])]),e("span",{class:Y(["element-count mb-2",s.pagination.total?"":"d-none"])},[s.pagination.last_page?(c(),u("span",Re,a(_.value.sequenceNumber)+" / ",1)):P("",!0),y(a(_.value.theNumber),1)],2)])}}});export{He as default};
