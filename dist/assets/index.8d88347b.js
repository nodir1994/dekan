import{_ as Z}from"./Pagination.f4a9fc5d.js";import{_ as J}from"./LoadingOverlay.vue_vue_type_script_setup_true_lang.89ce9ad6.js";/* empty css                                                       */import{d as I,c as G,h as K,a as T,bO as Q,B as g,Z as j,y as X,w as F,i as V,o as i,e as d,j as m,k as $,f as a,t as o,bR as x,u as ee,bq as ae,b6 as te,z as L,bs as se,s as z,l as S,F as q,r as R,q as oe,aR as le}from"./index.3390162f.js";import{a as ne}from"./index.75fe2edd.js";import{q as re,D as ie,E as de,F as ue,G as ce}from"./index.30e99442.js";import{_ as _e}from"./PageHeader.vue_vue_type_script_setup_true_lang.546c13dd.js";import{h as me}from"./helper.569bc08f.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./vue.runtime.esm-bundler.84001772.js";import"./sweetalert2.all.fdef424e.js";import"./moment.2cad4b18.js";const pe={class:"collapse__block"},fe={class:"row"},he={class:"my-2 col-md-6 form--item"},ve={for:"yu"},ye={class:"my-2 col-md-6 form--item"},be={for:"yu"},ge={class:"my-2 col-md-3 form--item"},$e={for:"yu"},we={class:"my-2 col-md-3 form--item"},Fe={for:"yu"},ke={class:"text-danger"},Ce={class:"my-2 col-md-4 form--item"},Ne={for:"yu"},Le={class:"text-danger"},Pe={class:"my-2 col-md-2"},Ee=["disabled"],Be={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Se={key:1,class:"mdi mdi-plus font-size-14 align-middle me-1"},Ve=I({__name:"LessonScheduleFilter",props:{filterForm:{}},emits:["search","open","update:filterForm"],setup(k,{emit:h}){const P=G(()=>{var e,t;return(t=(e=y==null?void 0:y.user)==null?void 0:e.faculty)==null?void 0:t.name}),y=K(),D=k,E=h,{t:v}=T(),n=Q(),p=g(!1),C=g([]),U=g([]),A=g([]),l=g([]),u=g([]),f=g(),c=G({get(){return D.filterForm},set(e){E("update:filterForm",e)}}),w=j({academic_group_id:[],edu_plan_id:[],semester_id:[]});X(async()=>{Promise.all([re()]).then(e=>{var t;C.value=(t=e[0].result)==null?void 0:t.data}),await N(),await O(),await Y(),D.filterForm.academic_year_id=f.value}),F(c,async(e,t)=>{E("search")},{deep:!0}),F(()=>c.value.faculty_id,async e=>N(e)),F(()=>c.value.edu_plan_id,e=>{O()},{immediate:!0}),F(()=>c.value.academic_year_id,async(e,t)=>{r(c.value.edu_plan_id)},{immediate:!0}),F(()=>c.value.edu_plan_id,async(e,t)=>{r(c.value.edu_plan_id)},{immediate:!0}),F(()=>c.value.edu_plan_id,async e=>Y(e));async function B(){var e,t;try{p.value=!0;const s={semester_id:c.value.semester_id,academic_group_id:c.value.academic_group_id},_=await ne(s);n.success(v("Data_stored_successfully")),E("open",_.result.id)}catch(s){Object.assign(w,(t=(e=s.response)==null?void 0:e.data)==null?void 0:t.errors)}finally{p.value=!1}}async function N(e){var s;const t=await ie(e);U.value=(s=t.result)==null?void 0:s.data}async function O(){var t,s;const e=await de();A.value=(t=e.result)==null?void 0:t.data,f.value=(s=e.result)==null?void 0:s.data.find(_=>_.is_current==!0).id}async function r(e){var t;if(e){const s=await ue(e,c.value.academic_year_id);l.value=(t=s==null?void 0:s.result)==null?void 0:t.data.map(_=>({id:_.id,name:_.semester+"-"+v("semester_number")+" / "+_.course+"-"+v("course_number")}))}}async function Y(e){var s;const t=await ce(e);u.value=(s=t.result)==null?void 0:s.data}return(e,t)=>{const s=V("a-select"),_=V("a-space"),H=V("b-card"),M=V("b-collapse");return i(),d("div",pe,[m(M,{visible:"",id:"collapse-3"},{default:$(()=>[m(H,null,{default:$(()=>[a("div",fe,[a("div",he,[m(_,null,{default:$(()=>[m(s,{class:"form--item","field-names":{value:"id",label:"name"},"allow-clear":"",options:C.value,"show-search":"",value:P.value,"onUpdate:value":t[0]||(t[0]=b=>P.value=b),disabled:""},null,8,["options","value"])]),_:1}),a("label",ve,o(e.$t("Choose_faculty")),1)]),a("div",ye,[m(_,null,{default:$(()=>[m(s,{class:"form--item",value:e.filterForm.edu_plan_id,"onUpdate:value":t[1]||(t[1]=b=>e.filterForm.edu_plan_id=b),"field-names":{value:"id",label:"name"},options:U.value,"allow-clear":"","show-search":""},null,8,["value","options"])]),_:1}),a("label",be,o(e.$t("Choose_Curriculum")),1)]),a("div",ge,[m(_,null,{default:$(()=>[m(s,{class:"form--item",value:e.filterForm.academic_year_id,"onUpdate:value":t[2]||(t[2]=b=>e.filterForm.academic_year_id=b),"field-names":{value:"id",label:"name"},options:A.value,disabled:!e.filterForm.edu_plan_id,"allow-clear":"","show-search":""},null,8,["value","options","disabled"])]),_:1}),a("label",$e,o(e.$t("Choose_Education_Year")),1)]),a("div",we,[m(_,null,{default:$(()=>[m(s,{class:"form--item",value:e.filterForm.semester_id,"onUpdate:value":t[3]||(t[3]=b=>e.filterForm.semester_id=b),"field-names":{value:"id",label:"name"},options:l.value,"allow-clear":"",disabled:l.value.length==0||!e.filterForm.edu_plan_id||!e.filterForm.academic_year_id,"show-search":""},null,8,["value","options","disabled"])]),_:1}),a("label",Fe,o(e.$t("Choose_Semester")),1),a("span",ke,o(w.semester_id[0]),1)]),a("div",Ce,[m(_,null,{default:$(()=>[m(s,{class:"form--item",value:e.filterForm.academic_group_id,"onUpdate:value":t[4]||(t[4]=b=>e.filterForm.academic_group_id=b),"field-names":{value:"id",label:"name"},options:u.value,disabled:l.value.length==0||!e.filterForm.semester_id,"allow-clear":"","show-search":""},null,8,["value","options","disabled"])]),_:1}),a("label",Ne,o(e.$t("Select_Group")),1),a("span",Le,o(w.academic_group_id[0]),1)]),a("div",Pe,[a("button",{class:"btn-search c-save",type:"button",onClick:B,disabled:!e.filterForm.academic_group_id||!e.filterForm.semester_id},[p.value?(i(),d("span",Be)):(i(),d("i",Se)),a("span",null,o(e.$t("Create")),1)],8,Ee)])])]),_:1})]),_:1})])}}}),W=x();async function De(k){try{const{data:h}=await W({url:"/api/lesson-schedule",params:k});return h}catch(h){throw h}}async function Ue(k){try{const{data:h}=await W({url:"/api/lesson-schedule/export",responseType:"blob",params:k});return h}catch(h){throw h}}const Ae={pagetitle:"'Dars jadvali'",class:"schedule-list-page-lesson"},Oe={class:"filterBlock"},Ye=a("i",{class:"mdi mdi-download font-size-14 align-middle me-1"},null,-1),qe={class:"btns c-filter py-1.5 px-4"},je=a("i",{class:"mdi mdi-filter font-size-14 align-middle me-1"},null,-1),Ge={class:"card"},ze={class:"card-body"},Re={key:1,class:"table-responsive"},Ie={class:"content-table"},Te={class:"table-row w-100 d-grid"},We=a("i",{class:"mdi mdi-arrow-top-right me-1"},null,-1),He={key:0},Me={key:1},Ze={key:2},Je={class:"text-center"},Ke={class:"text-center mb-0"},Qe={key:0,class:"element-count mb-2"},Xe={key:0},ca=I({__name:"index",async setup(k){let h,P;const y=g({sequenceNumber:null,theNumber:null,sorting:null}),{t:D}=T(),E=ee(),v=g(!1),n=j({current_page:1,data:[],links:[]}),p=j({faculty_id:null,edu_plan_id:null,edu_form_id:null,academic_year_id:null,semester_id:null,academic_group_id:null,page:1,per_page:me.pagePer});[h,P]=ae(()=>C()),await h,P(),F(()=>n.current_page,async l=>{l&&await C()});async function C(l){v.value=!0;const u={...p,page:n.current_page},f=await De(u);Object.assign(n,f.result),p.academic_group_id&&n.data.length&&n.data.map(N=>({id:N.id}));let c=`${n.current_page}- ${n.data.length+n.per_page*(n.current_page-1)}`,w=`${D("Total_Point")} : ${n.total}`,B=n.per_page*(n.current_page-1);v.value=!1,y.value.sequenceNumber=c,y.value.theNumber=w,y.value.sorting=B}async function U(){delete p.page,delete p.per_page;try{v.value=!0;const l=await Ue(p),u=URL.createObjectURL(new Blob([l],{type:"application/vnd.ms-excel"})),f=document.createElement("a");f.href=u,f.setAttribute("download",`Worksheet_${Date.now()}.xlsx`),document.body.appendChild(f),f.click()}catch(l){console.log({error:l})}finally{v.value=!1}}function A(l){Object.getOwnPropertyNames(p).forEach(f=>{p[f]&&p[f]});const u=`/curriculum/info-schedule/${l}`;E.push({path:u})}return(l,u)=>{const f=_e,c=Ve,w=J,B=V("router-link"),N=Z,O=te("b-toggle");return i(),d("div",Ae,[m(f,{title:l.$t("Curriculum_Schedule")},{default:$(()=>[a("div",Oe,[a("button",{class:"btns c-save py-1.5 px-4 me-3",onClick:u[0]||(u[0]=r=>U())},[Ye,L(o(l.$t("Download")),1)]),se((i(),d("button",qe,[je,L(o(l.$t("Filter")),1)])),[[O,void 0,void 0,{"collapse-3":!0}]])])]),_:1},8,["title"]),m(c,{"filter-form":p,"onUpdate:filterForm":u[1]||(u[1]=r=>p=r),onSearch:C,onOpen:A},null,8,["filter-form"]),a("div",Ge,[a("div",ze,[v.value?(i(),z(w,{key:0})):S("",!0),n.data.length?(i(),d("div",Re,[a("table",Ie,[a("thead",null,[a("tr",Te,[a("th",null,o(l.$t("Curriculum")),1),a("th",null,o(l.$t("Education_Year_Name")),1),a("th",null,o(l.$t("Semester_Name")),1),a("th",null,o(l.$t("Group")),1),a("th",null,o(l.$t("Count_of_weeks")),1),a("th",null,o(l.$t("Weeks_lessons")),1)])]),a("tbody",null,[(i(!0),d(q,null,R(n.data,(r,Y)=>{var e,t;return i(),d("tr",{class:"table-row w-100 d-grid",key:Y},[a("td",null,o(r.edu_plan),1),a("td",null,o(r.academic_year),1),a("td",null,[(e=r==null?void 0:r.semester)!=null&&e.semester?(i(),d(q,{key:0},[L(o((t=r==null?void 0:r.semester)==null?void 0:t.semester)+"- "+o(l.$t("semester_number")),1)],64)):S("",!0)]),a("td",null,[m(B,{class:"btn text-primary p-0",type:"button",to:`/curriculum/info-schedule/${r.id}`},{default:$(()=>{var s;return[We,L(" "+o((s=r==null?void 0:r.academic_group)==null?void 0:s.name),1)]}),_:2},1032,["to"])]),a("td",null,o(r.week_count),1),a("td",null,[(i(!0),d(q,null,R(r.weeks,(s,_)=>(i(),d("div",{key:_},[a("span",{class:oe([s.count!=0?"actions-h":"actions-r","btns1"])},[L(" \u2116"+o(s==null?void 0:s.position)+" ",1),s.count?(i(),d("span",Me,"- "+o(s.count),1)):(i(),d("span",He,"- 0"))],2)]))),128))])])}),128))])]),n.last_page>1?(i(),z(N,le({key:0,class:"mt-2"},{...n},{"current-page":n.current_page,"onUpdate:currentPage":u[2]||(u[2]=r=>n.current_page=r),loading:v.value}),null,16,["current-page","loading"])):S("",!0)])):(i(),d("div",Ze,[a("h5",Je,o(l.$t("No_data")),1),a("p",Ke,o(l.$t("No_information_found")),1)]))])]),n.data.length?(i(),d("span",Qe,[n.last_page>1?(i(),d("span",Xe,o(y.value.sequenceNumber)+" / ",1)):S("",!0),L(o(y.value.theNumber),1)])):S("",!0)])}}});export{ca as default};
